!function(){function g(e,t,i,r){if(!e.isReadOnly()&&!e.equals(i.editable())){CKEDITOR.dom.element.setMarker(r,e,"bidi_processed",1),r=e;for(var o=i.editable();(r=r.getParent())&&!r.equals(o);)if(r.getCustomData("bidi_processed"))return e.removeStyle("direction"),void e.removeAttribute("dir");((r="useComputedState"in i.config?i.config.useComputedState:1)?e.getComputedStyle("direction"):e.getStyle("direction")||e.hasAttribute("dir"))!=t&&(e.removeStyle("direction"),r?(e.removeAttribute("dir"),t!=e.getComputedStyle("direction")&&e.setAttribute("dir",t)):e.setAttribute("dir",t),i.forceNextSelectionCheck())}}function i(u){return{context:"p",allowedContent:{"h1 h2 h3 h4 h5 h6 table ul ol blockquote div tr p div li td":{propertiesOnly:!0,attributes:"dir"}},requiredContent:"p[dir]",refresh:function(e,t){var i=e.config.useComputedState;if(!(i=void 0===i||i))for(var r=t.lastElement,o=e.editable();r&&!(r.getName()in a||r.equals(o));){var n=r.getParent();if(!n)break;r=n}(r=(r=r||t.block||t.blockLimit).equals(e.editable())&&(o=e.getSelection().getRanges()[0].getEnclosedNode())&&o.type==CKEDITOR.NODE_ELEMENT?o:r)&&(i=i?r.getComputedStyle("direction"):r.getStyle("direction")||r.getAttribute("dir"),e.getCommand("bidirtl").setState("rtl"==i?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),e.getCommand("bidiltr").setState("ltr"==i?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)),(i=(t.block||t.blockLimit||e.editable()).getDirection(1))!=(e._.selDir||e.lang.dir)&&(e._.selDir=i,e.fire("contentDirChanged",i))},exec:function(e){var t=e.getSelection(),r=e.config.enterMode;if((a=t.getRanges())&&a.length){for(var i,o={},n=t.createBookmarks(),a=a.createIterator(),d=0;i=a.getNextRange(1);){var l=i.getEnclosedNode();(l=!l||l&&!(l.type==CKEDITOR.NODE_ELEMENT&&l.getName()in C)?function(e,t,i){var r,o=e.getCommonAncestor(!1,!0);if((e=e.clone()).enlarge(i==CKEDITOR.ENTER_BR?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS),e.checkBoundaryOfElement(o,CKEDITOR.START)&&e.checkBoundaryOfElement(o,CKEDITOR.END)){for(;o&&o.type==CKEDITOR.NODE_ELEMENT&&(r=o.getParent())&&1==r.getChildCount()&&!(o.getName()in t);)o=r;return o.type==CKEDITOR.NODE_ELEMENT&&o.getName()in t&&o}}(i,T,r):l)&&g(l,u,e,o);var c=new CKEDITOR.dom.walker(i),E=n[d].startNode,s=n[d++].endNode;for(c.evaluator=function(e){var t,i=r==CKEDITOR.ENTER_P?"p":"div";return!!((t=(t=!!e&&e.type==CKEDITOR.NODE_ELEMENT&&e.getName()in T)?!((i=(i=e.is(i))?!!(i=e.getParent())&&i.type==CKEDITOR.NODE_ELEMENT:i)&&e.getParent().is("blockquote")):t)&&e.getPosition(E)&CKEDITOR.POSITION_FOLLOWING&&(e.getPosition(s)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_CONTAINS)==CKEDITOR.POSITION_PRECEDING)};l=c.next();)g(l,u,e,o);for((i=i.createIterator()).enlargeBr=r!=CKEDITOR.ENTER_BR;l=i.getNextParagraph(r==CKEDITOR.ENTER_P?"p":"div");)g(l,u,e,o)}CKEDITOR.dom.element.clearAllMarkers(o),e.forceNextSelectionCheck(),t.selectBookmarks(n),e.focus()}}}}function e(o){var n=o==t.setAttribute,a=o==t.removeAttribute,d=/\bdirection\s*:\s*(.*?)\s*(:?$|;)/;return function(e,t){if(!this.isReadOnly()){if(i=e==(n||a?"dir":"direction")||"style"==e&&(a||d.test(t))){e:{for(var i,r=(i=this).getDocument().getBody().getParent();i;){if(i.equals(r)){i=!1;break e}i=i.getParent()}i=!0}i=!i}if(i&&(i=this.getDirection(1),r=o.apply(this,arguments),i!=this.getDirection(1)))return this.getDocument().fire("dirChanged",this),r}return o.apply(this,arguments)}}var T={table:1,ul:1,ol:1,blockquote:1,div:1},C={},a={};CKEDITOR.tools.extend(C,T,{tr:1,p:1,div:1,li:1}),CKEDITOR.tools.extend(a,C,{td:1}),CKEDITOR.plugins.add("bidi",{lang:"af,ar,az,bg,bn,bs,ca,cs,cy,da,de,de-ch,el,en,en-au,en-ca,en-gb,eo,es,es-mx,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,oc,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",icons:"bidiltr,bidirtl",hidpi:!0,init:function(n){function e(e,t,i,r,o){n.addCommand(i,new CKEDITOR.command(n,r)),n.ui.addButton&&n.ui.addButton(e,{label:t,command:i,toolbar:"bidi,"+o})}var t;n.blockless||(e("BidiLtr",(t=n.lang.bidi).ltr,"bidiltr",i("ltr"),10),e("BidiRtl",t.rtl,"bidirtl",i("rtl"),20),n.on("contentDom",function(){n.document.on("dirChanged",function(e){n.fire("dirChanged",{node:e.data,dir:e.data.getDirection(1)})})}),n.on("contentDirChanged",function(e){e=(n.lang.dir!=e.data?"add":"remove")+"Class";var t=n.ui.space(n.config.toolbarLocation);t&&t[e]("cke_mixed_dir_content")}))}});for(var t=CKEDITOR.dom.element.prototype,r=["setStyle","removeStyle","setAttribute","removeAttribute"],o=0;o<r.length;o++)t[r[o]]=CKEDITOR.tools.override(t[r[o]],e)}();