CKEDITOR.plugins.add("preview",{lang:"af,ar,az,bg,bn,bs,ca,cs,cy,da,de,de-ch,el,en,en-au,en-ca,en-gb,eo,es,es-mx,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,oc,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",icons:"preview,preview-rtl",hidpi:!0,init:function(e){e.addCommand("preview",{modes:{wysiwyg:1},canUndo:!1,readOnly:1,exec:function(){CKEDITOR.plugins.preview.createPreview(e)}}),e.ui.addButton&&e.ui.addButton("Preview",{label:e.lang.preview.preview,command:"preview",toolbar:"document,40"})}}),CKEDITOR.plugins.preview={createPreview:function(e,t){var n,i,a,o,l,r,c,d,a={dataValue:(n=e,s=t,a=CKEDITOR.plugins.getPath("preview"),d=n.config,o=n.title,i=location.origin,l=location.pathname,l=d.baseHref||CKEDITOR.env.gecko?d.baseHref?'<base href="{HREF}">'.replace("{HREF}",d.baseHref):((l=l.split("/")).pop(),l=l.join("/"),'<base href="{HREF}">'.replace("{HREF}",i+l+"/")):"",d.fullPage?n.getData().replace(/<head>/,"$&"+l).replace(/[^>]*(?=<\/title>)/,"$& &mdash; "+o):d.docType+'<html dir="'+d.contentsLangDirection+'"><head>'+l+"<title>"+o+"</title>"+CKEDITOR.tools.buildStyleHtml(d.contentsCss)+'<link rel="stylesheet" media="screen" href="'+a+'styles/screen.css"></head>'+(d="<body>",(a=n.document&&n.document.getBody())?(a.getAttribute("id")&&(d=d.replace(">",' id="'+a.getAttribute("id")+'">')),a.getAttribute("class")?d.replace(">",' class="'+a.getAttribute("class")+'">'):d):d)+n.getData()+(s?"<script>"+(CKEDITOR.env.ie?"window.onload":"document.onreadystatechange")+" = function() { previewCallback(); } <\/script>":"")+"</body></html>")},n=(d=window.screen,{width:Math.round(.8*d.width),height:Math.round(.7*d.height),left:Math.round(.1*d.width)}),s=CKEDITOR.env.ie||CKEDITOR.env.gecko?"javascript:void( (function(){document.open();"+("("+CKEDITOR.tools.fixDomain+")();").replace(/\/\/.*?\n/g,"").replace(/parent\./g,"window.opener.")+"document.write( window.opener._cke_htmlToLoad );document.close();window.opener._cke_htmlToLoad = null;})() )":null,d=(d=CKEDITOR.plugins.getPath("preview"),CKEDITOR.env.gecko?CKEDITOR.getUrl(d+"preview.html"):"");return!1!==e.fire("contentPreview",a)&&((s||d)&&(window._cke_htmlToLoad=a.dataValue),r=window.open(d,null,["toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes","width="+n.width,"height="+n.height,"left="+n.left].join()),c=new CKEDITOR.dom.window(r),s&&r&&(r.location=s),window._cke_htmlToLoad||((n=r.document).open(),n.write(a.dataValue),n.close()),t&&(r.previewCallback=function(){"complete"===r.document.readyState&&t(c)},r.previewCallback()),c)}};