CKEDITOR.dialog.add("docProps",function(c){function o(i,t){function n(t){t.on("ok",e),t.on("cancel",o)}var e=function(){o(this),t(this,this._.parentDialog)},o=function(t){t.removeListener("ok",e),t.removeListener("cancel",o)};c.execCommand(i),c._.storedDialogs.colordialog?n(c._.storedDialogs.colordialog):CKEDITOR.on("dialogDefinition",function(t){var e;t.data.name==i&&(e=t.data.definition,t.removeListener(),e.onLoad=CKEDITOR.tools.override(e.onLoad,function(t){return function(){n(this),"function"==typeof(e.onLoad=t)&&t.call(this)}}))})}function i(){var t=this.getDialog().getContentElement("general",this.id+"Other");t&&("other"==this.getValue()?(t.getInputElement().removeAttribute("readOnly"),t.focus(),t.getElement().removeClass("cke_disabled")):(t.getInputElement().setAttribute("readOnly",!0),t.getElement().addClass("cke_disabled")))}function l(n,o,l){return function(t,e,i){e=g,!(t=void 0!==l?l:this.getValue())&&n in e?e[n].remove():t&&n in e?e[n].setAttribute("content",t):t&&((e=new CKEDITOR.dom.element("meta",c.document)).setAttribute(o?"http-equiv":"name",n),e.setAttribute("content",t),i.append(e))}}function n(e,i){return function(){var t=e in(t=g)&&t[e].getAttribute("content")||"";return i?t:(this.setValue(t),null)}}function t(o){return function(t,e,i,n){n.removeAttribute("margin"+o),""!==(t=this.getValue())?n.setStyle("margin-"+o,CKEDITOR.tools.cssLength(t)):n.removeStyle("margin-"+o)}}function a(t,e,i){t.removeStyle(e),t.getComputedStyle(e)!=i&&t.setStyle(e,i)}function e(n,t,e){return{type:"hbox",padding:0,widths:["60%","40%"],children:[CKEDITOR.tools.extend({type:"text",id:n,label:r[t]},e||{},1),{type:"button",id:n+"Choose",label:r.chooseColor,className:"colorChooser",onClick:function(){var i=this;o("colordialog",function(t){var e=i.getDialog();e.getContentElement(e._.currentTabId,n).setValue(t.getContentElement("picker","selectedColor").getValue())})}}]}}var r=c.lang.docprops,s=c.lang.common,g={},h="javascript:void((function(){"+encodeURIComponent("document.open();"+(CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"")+'document.write( \'<html style="background-color: #ffffff; height: 100%"><head></head><body style="width: 100%; height: 100%; margin: 0px">'+r.previewHtml+"</body></html>' );document.close();")+"})())";return{title:r.title,minHeight:330,minWidth:500,getModel:function(){return c.document},onShow:function(){for(var t=c.document,e=t.getElementsByTag("html").getItem(0),i=t.getHead(),n=t.getBody(),o={},l=t.getElementsByTag("meta"),a=l.count(),r=0;r<a;r++){var s=l.getItem(r);o[s.getAttribute(s.hasAttribute("http-equiv")?"http-equiv":"name").toLowerCase()]=s}g=o,this.setupContent(t,e,i,n)},onHide:function(){g={}},onOk:function(){var t=c.document,e=t.getElementsByTag("html").getItem(0),i=t.getHead(),n=t.getBody();this.commitContent(t,e,i,n)},contents:[{id:"general",label:s.generalTab,elements:[{type:"text",id:"title",label:r.docTitle,setup:function(t){this.setValue(t.getElementsByTag("title").getItem(0).data("cke-title"))},commit:function(t,e,i,n,o){o||t.getElementsByTag("title").getItem(0).data("cke-title",this.getValue())}},{type:"hbox",children:[{type:"select",id:"dir",label:s.langDir,style:"width: 100%",items:[[s.notSet,""],[s.langDirLtr,"ltr"],[s.langDirRtl,"rtl"]],setup:function(t,e,i,n){this.setValue(n.getDirection()||"")},commit:function(t,e,i,n){(t=this.getValue())?n.setAttribute("dir",t):n.removeAttribute("dir"),n.removeStyle("direction")}},{type:"text",id:"langCode",label:s.langCode,setup:function(t,e){this.setValue(e.getAttribute("xml:lang")||e.getAttribute("lang")||"")},commit:function(t,e,i,n,o){o||((t=this.getValue())?e.setAttributes({"xml:lang":t,lang:t}):e.removeAttributes({"xml:lang":1,lang:1}))}}]},{type:"hbox",children:[{type:"select",id:"charset",label:r.charset,style:"width: 100%",items:[[s.notSet,""],[r.charsetASCII,"us-ascii"],[r.charsetCE,"iso-8859-2"],[r.charsetCT,"big5"],[r.charsetCR,"iso-8859-5"],[r.charsetGR,"iso-8859-7"],[r.charsetJP,"iso-2022-jp"],[r.charsetKR,"iso-2022-kr"],[r.charsetTR,"iso-8859-9"],[r.charsetUN,"utf-8"],[r.charsetWE,"iso-8859-1"],[r.other,"other"]],default:"",onChange:function(){this.getDialog().selectedCharset="other"!=this.getValue()?this.getValue():"",i.call(this)},setup:function(){this.metaCharset="charset"in g;var t,e=n(this.metaCharset?"charset":"content-type",1).call(this);(e=!this.metaCharset&&e.match(/charset=[^=]+$/)?e.substring(e.indexOf("=")+1):e)&&(this.setValue(e.toLowerCase()),this.getValue()||(this.setValue("other"),(t=this.getDialog().getContentElement("general","charsetOther"))&&t.setValue(e)),this.getDialog().selectedCharset=e),i.call(this)},commit:function(t,e,i,n,o){o||(n=this.getValue(),o=this.getDialog().getContentElement("general","charsetOther"),(n="other"==n?o?o.getValue():"":n)&&!this.metaCharset&&(n=(g["content-type"]?g["content-type"].getAttribute("content").split(";")[0]:"text/html")+"; charset="+n),l(this.metaCharset?"charset":"content-type",1,n).call(this,t,e,i))}},{type:"text",id:"charsetOther",label:r.charsetOther,onChange:function(){this.getDialog().selectedCharset=this.getValue()}}]},{type:"hbox",children:[{type:"select",id:"docType",label:r.docType,style:"width: 100%",items:[[s.notSet,""],["XHTML 1.1",'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'],["XHTML 1.0 Transitional",'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'],["XHTML 1.0 Strict",'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">'],["XHTML 1.0 Frameset",'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">'],["HTML 5","<!DOCTYPE html>"],["HTML 4.01 Transitional",'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">'],["HTML 4.01 Strict",'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">'],["HTML 4.01 Frameset",'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd">'],["HTML 3.2",'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">'],["HTML 2.0",'<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">'],[r.other,"other"]],onChange:i,setup:function(){var t;c.docType&&(this.setValue(c.docType),!this.getValue())&&(this.setValue("other"),(t=this.getDialog().getContentElement("general","docTypeOther"))&&t.setValue(c.docType)),i.call(this)},commit:function(t,e,i,n,o){o||(t=this.getValue(),e=this.getDialog().getContentElement("general","docTypeOther"),c.docType="other"==t?e?e.getValue():"":t)}},{type:"text",id:"docTypeOther",label:r.docTypeOther}]},{type:"checkbox",id:"xhtmlDec",label:r.xhtmlDec,setup:function(){this.setValue(!!c.xmlDeclaration)},commit:function(t,e,i,n,o){o||(this.getValue()?(c.xmlDeclaration='<?xml version="1.0" encoding="'+(this.getDialog().selectedCharset||"utf-8")+'"?>',e.setAttribute("xmlns","http://www.w3.org/1999/xhtml")):(c.xmlDeclaration="",e.removeAttribute("xmlns")))}}]},{id:"design",label:r.design,elements:[{type:"hbox",widths:["60%","40%"],children:[{type:"vbox",children:[e("txtColor","txtColor",{setup:function(t,e,i,n){this.setValue(n.getComputedStyle("color"))},commit:function(t,e,i,n,o){(this.isChanged()||o)&&(n.removeAttribute("text"),(t=this.getValue())?n.setStyle("color",t):n.removeStyle("color"))}}),e("bgColor","bgColor",{setup:function(t,e,i,n){t=n.getComputedStyle("background-color")||"",this.setValue("transparent"==t?"":t)},commit:function(t,e,i,n,o){(this.isChanged()||o)&&(n.removeAttribute("bgcolor"),(t=this.getValue())?n.setStyle("background-color",t):a(n,"background-color","transparent"))}}),{type:"hbox",widths:["60%","40%"],padding:1,children:[{type:"text",id:"bgImage",label:r.bgImage,setup:function(t,e,i,n){t="none"==(t=n.getComputedStyle("background-image")||"")?"":t.replace(/url\(\s*(["']?)\s*([^\)]*)\s*\1\s*\)/i,function(t,e,i){return i}),this.setValue(t)},commit:function(t,e,i,n){n.removeAttribute("background"),(t=this.getValue())?n.setStyle("background-image","url("+t+")"):a(n,"background-image","none")}},{type:"button",id:"bgImageChoose",label:s.browseServer,style:"display:inline-block;margin-top:10px;",hidden:!0,filebrowser:"design:bgImage"}]},{type:"checkbox",id:"bgFixed",label:r.bgFixed,setup:function(t,e,i,n){this.setValue("fixed"==n.getComputedStyle("background-attachment"))},commit:function(t,e,i,n){this.getValue()?n.setStyle("background-attachment","fixed"):a(n,"background-attachment","scroll")}}]},{type:"vbox",children:[{type:"html",id:"marginTitle",html:'<div style="text-align: center; margin: 0px auto; font-weight: bold">'+r.margin+"</div>"},{type:"text",id:"marginTop",label:r.marginTop,style:"width: 80px; text-align: center",align:"center",inputStyle:"text-align: center",setup:function(t,e,i,n){this.setValue(n.getStyle("margin-top")||n.getAttribute("margintop")||"")},commit:t("top")},{type:"hbox",children:[{type:"text",id:"marginLeft",label:r.marginLeft,style:"width: 80px; text-align: center",align:"center",inputStyle:"text-align: center",setup:function(t,e,i,n){this.setValue(n.getStyle("margin-left")||n.getAttribute("marginleft")||"")},commit:t("left")},{type:"text",id:"marginRight",label:r.marginRight,style:"width: 80px; text-align: center",align:"center",inputStyle:"text-align: center",setup:function(t,e,i,n){this.setValue(n.getStyle("margin-right")||n.getAttribute("marginright")||"")},commit:t("right")}]},{type:"text",id:"marginBottom",label:r.marginBottom,style:"width: 80px; text-align: center",align:"center",inputStyle:"text-align: center",setup:function(t,e,i,n){this.setValue(n.getStyle("margin-bottom")||n.getAttribute("marginbottom")||"")},commit:t("bottom")}]}]}]},{id:"meta",label:r.meta,elements:[{type:"textarea",id:"metaKeywords",label:r.metaKeywords,setup:n("keywords"),commit:l("keywords")},{type:"textarea",id:"metaDescription",label:r.metaDescription,setup:n("description"),commit:l("description")},{type:"text",id:"metaAuthor",label:r.metaAuthor,setup:n("author"),commit:l("author")},{type:"text",id:"metaCopyright",label:r.metaCopyright,setup:n("copyright"),commit:l("copyright")}]},{id:"preview",label:s.preview,elements:[{type:"html",id:"previewHtml",html:'<iframe src="'+h+'" style="width: 100%; height: 310px" hidefocus="true" frameborder="0"></iframe>',onLoad:function(){var l=this.getElement();this.getDialog().on("selectPage",function(t){var o;"preview"==t.data.page&&(o=this,setTimeout(function(){var t=l.getFrameDocument(),e=t.getElementsByTag("html").getItem(0),i=t.getHead(),n=t.getBody();o.commitContent(t,e,i,n,1)},50))}),l.getAscendant("table").setStyle("height","100%")}}]}]}});