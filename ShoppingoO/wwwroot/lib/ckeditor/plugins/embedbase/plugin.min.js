!function(){var s={_attachScript:function(e,t){var n=new CKEDITOR.dom.element("script");return n.setAttribute("src",e),n.on("error",t),CKEDITOR.document.getBody().append(n),n},sendRequest:function(e,t,n,a){function s(){o&&(o.remove(),delete CKEDITOR._.jsonpCallbacks[r],o=null)}var i={};t=t||{};var o,r=CKEDITOR.tools.getNextNumber();return t.callback="CKEDITOR._.jsonpCallbacks["+r+"]",CKEDITOR._.jsonpCallbacks[r]=function(e){setTimeout(function(){s(),n(e)})},o=this._attachScript(e.output(t),function(){s(),a&&a()}),i.cancel=s,i}};CKEDITOR.plugins.add("embedbase",{lang:"ar,az,bg,ca,cs,da,de,de-ch,en,en-au,eo,es,es-mx,et,eu,fa,fr,gl,hr,hu,id,it,ja,ko,ku,lv,nb,nl,oc,pl,pt,pt-br,ro,ru,sk,sq,sr,sr-latn,sv,tr,ug,uk,zh,zh-cn",requires:"dialog,widget,notificationaggregator",onLoad:function(){CKEDITOR._.jsonpCallbacks={}},init:function(){CKEDITOR.dialog.add("embedBase",this.path+"dialogs/embedbase.js")}}),CKEDITOR.plugins.embedBase={createWidgetBaseDefinition:function(a){var e,t=a.lang.embedbase;return{mask:!0,template:"<div></div>",pathName:t.pathName,_cache:{},urlRegExp:/^((https?:)?\/\/|www\.)/i,init:function(){this.on("sendRequest",function(e){this._sendRequest(e.data)},this,null,999),this.on("handleResponse",function(e){var t;e.data.html||(null!==(t=this._responseToHtml(e.data.url,e.data.response))?e.data.html=t:(e.data.errorMessage="unsupportedUrl",e.cancel()))},this,null,999)},loadContent:function(t,n){function e(e){i.response=e,a.editor.widgets.instances[a.id]?a._handleResponse(i)&&(a._cacheResponse(t,e),n.callback&&n.callback()):(CKEDITOR.warn("embedbase-widget-invalid"),i.task&&i.task.done())}n=n||{};var a=this,s=this._getCachedResponse(t),i={noNotifications:n.noNotifications,url:t,callback:e,errorCallback:function(e){a._handleError(i,e),n.errorCallback&&n.errorCallback(e)}};if(!s)return n.noNotifications||(i.task=this._createTask()),this.fire("sendRequest",i),i;setTimeout(function(){e(s)})},isUrlValid:function(e){return this.urlRegExp.test(e)&&!1!==this.fire("validateUrl",e)},getErrorMessage:function(e,t,n){return(n=a.lang.embedbase[e+(n||"")])||(n=e),new CKEDITOR.template(n).output({url:t||""})},_sendRequest:function(e){var t=this,n=s.sendRequest(this.providerUrl,{url:encodeURIComponent(e.url)},e.callback,function(){e.errorCallback("fetchingFailed")});e.cancel=function(){n.cancel(),t.fire("requestCanceled",e)}},_handleResponse:function(e){var t={url:e.url,html:"",response:e.response};return!1!==this.fire("handleResponse",t)?(e.task&&e.task.done(),this._setContent(e.url,t.html),!0):(e.errorCallback(t.errorMessage),!1)},_handleError:function(e,t){e.task&&(e.task.cancel(),e.noNotifications||a.showNotification(this.getErrorMessage(t,e.url),"warning"))},_responseToHtml:function(e,t){return"photo"==t.type?'<img src="'+CKEDITOR.tools.htmlEncodeAttr(t.url)+'" alt="'+CKEDITOR.tools.htmlEncodeAttr(t.title||"")+'" style="max-width:100%;height:auto" />':"video"==t.type||"rich"==t.type?(t.html=t.html.replace(/<iframe/g,'<iframe tabindex="-1"'),t.html):null},_setContent:function(e,t){this.setData("url",e),this.element.setHtml(t)},_createTask:function(){return e&&!e.isFinished()||(e=new CKEDITOR.plugins.notificationAggregator(a,t.fetchingMany,t.fetchingOne)).on("finished",function(){e.notification.hide()}),e.createTask()},_cacheResponse:function(e,t){this._cache[e]=t},_getCachedResponse:function(e){return this._cache[e]}}},_jsonp:s}}();