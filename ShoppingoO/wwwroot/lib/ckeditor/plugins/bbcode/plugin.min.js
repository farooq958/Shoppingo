!function(){CKEDITOR.on("dialogDefinition",function(e){var t=e.data.name;e=e.data.definition,"link"==t?(e.removeContents("target"),e.removeContents("upload"),e.removeContents("advanced"),(t=e.getContents("info")).remove("emailSubject"),t.remove("emailBody")):"image"==t&&(e.removeContents("advanced"),(t=e.getContents("Link")).remove("cmbTarget"),(t=e.getContents("info")).remove("txtAlt"),t.remove("basic"))});var e,c={b:"strong",u:"u",i:"em",s:"s",color:"span",size:"span",left:"div",right:"div",center:"div",justify:"div",quote:"blockquote",code:"code",url:"a",email:"span",img:"span","*":"li",list:"ol"},u={strong:"b",b:"b",u:"u",em:"i",i:"i",s:"s",code:"code",li:"*"},s={strong:"b",em:"i",u:"u",s:"s",li:"*",ul:"list",ol:"list",code:"code",a:"link",img:"img",blockquote:"quote"},h={color:"color",size:"font-size",left:"text-align",center:"text-align",right:"text-align",justify:"text-align"},f={url:"href",email:"mailhref",quote:"cite",list:"listType"},t=CKEDITOR.dtd,d=CKEDITOR.tools.extend({table:1},t.$block,t.$listItem,t.$tableContent,t.$list),m=/\s*(?:;\s*|$)/,p={smiley:":)",sad:":(",wink:";)",laugh:":D",cheeky:":P",blush:":*)",surprise:":-o",indecision:":|",angry:">:(",angel:"o:)",cool:"8-)",devil:">:-)",crying:";(",kiss:":-*"},g={},b=[];for(e in p)g[p[e]]=e,b.push(p[e].replace(/\(|\)|\:|\/|\*|\-|\|/g,function(e){return"\\"+e}));var b=new RegExp(b.join("|"),"g"),n=function(){var e,t=[],n={nbsp:" ",shy:"­"};for(e in n)t.push(e);return t=new RegExp("&("+t.join("|")+");","g"),function(e){return e.replace(t,function(e,t){return n[t]})}}();CKEDITOR.BBCodeParser=function(){this._={bbcPartsRegex:/(?:\[([^\/\]=]*?)(?:=([^\]]*?))?\])|(?:\[\/([a-z]{1,16})\])/gi}},CKEDITOR.BBCodeParser.prototype={parse:function(e){for(var t,n=0;a=this._.bbcPartsRegex.exec(e);)if(n<(t=a.index)&&(n=e.substring(n,t),this.onText(n,1)),n=this._.bbcPartsRegex.lastIndex,(t=(a[1]||a[3]||"").toLowerCase())&&!c[t])this.onText(a[0]);else if(a[1]){var i=c[t],r={},s={};if(a=a[2],a="left"==t||"right"==t||"center"==t||"justify"==t?t:a)if("list"==t&&(isNaN(a)?/^[a-z]+$/.test(a)?a="lower-alpha":/^[A-Z]+$/.test(a)&&(a="upper-alpha"):a="decimal"),h[t]){"size"==t&&(a+="%"),s[h[t]]=a;var a=r,l="",o=void 0;for(o in s)var u=(o+":"+s[o]).replace(m,";"),l=l+u;a.style=l}else f[t]&&(r[f[t]]=CKEDITOR.tools.htmlDecode(a));"email"!=t&&"img"!=t||(r.bbcode=t),this.onTagOpen(i,r,CKEDITOR.dtd.$empty[i])}else a[3]&&this.onTagClose(c[t]);e.length>n&&this.onText(e.substring(n,e.length),1)}},CKEDITOR.htmlParser.fragment.fromBBCode=function(e){function a(e){if(0<h.length)for(var t=0;t<h.length;t++){var n=h[t],i=n.name,r=CKEDITOR.dtd[i],s=f.name&&CKEDITOR.dtd[f.name];s&&!s[i]||e&&r&&!r[e]&&CKEDITOR.dtd[e]||((n=n.clone()).parent=f,f=n,h.splice(t,1),t--)}}function l(e,t){var n=!(i=0<(n=f.children.length)&&f.children[n-1])&&C.getRule(s[f.name],"breakAfterOpen"),i=i&&i.type==CKEDITOR.NODE_ELEMENT&&C.getRule(s[i.name],"breakAfterClose"),t=e&&C.getRule(s[e],t?"breakBeforeClose":"breakBeforeOpen");r&&(n||i||t)&&r--,r&&e in d&&r++;for(;r&&r--;)f.children.push(new CKEDITOR.htmlParser.element("br"))}function o(e,t){l(e.name,1);var n=(t=t||f||i).children.length;e.previous=0<n&&t.children[n-1]||null,(e.parent=t).children.push(e),e.returnPoint&&(f=e.returnPoint,delete e.returnPoint)}var u,c=new CKEDITOR.BBCodeParser,i=new CKEDITOR.htmlParser.fragment,h=[],r=0,f=i;for(c.onTagOpen=function(e,t){var n=new CKEDITOR.htmlParser.element(e,t);if(CKEDITOR.dtd.$removeEmpty[e])h.push(n);else{var i=f.name;if((s=i&&(CKEDITOR.dtd[i]||(f._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span)))&&!s[e]){var r,s=!1;if(e==i?o(f,f.parent):(e in CKEDITOR.dtd.$listItem?(c.onTagOpen("ul",{}),r=f):(o(f,f.parent),h.unshift(f)),s=!0),f=r||f.returnPoint||f.parent,s)return void c.onTagOpen.apply(this,arguments)}a(e),l(e),n.parent=f,n.returnPoint=u,u=0,n.isEmpty?o(n):f=n}},c.onTagClose=function(e){for(var t=h.length-1;0<=t;t--)if(e==h[t].name)return void h.splice(t,1);for(var n=[],i=[],r=f;r.type&&r.name!=e;)r._.isBlockLike||i.unshift(r),n.push(r),r=r.parent;if(r.type){for(t=0;t<n.length;t++)o(e=n[t],e.parent);o(f=r,r.parent),r==f&&(f=f.parent),h=h.concat(i)}},c.onText=function(e){var t=CKEDITOR.dtd[f.name];t&&!t["#"]||(l(),a(),e.replace(/(\r\n|[\r\n])|[^\r\n]*/g,function(n,e){var i;void 0!==e&&e.length?r++:n.length&&(i=0,n.replace(b,function(e,t){o(new CKEDITOR.htmlParser.text(n.substring(i,t)),f),o(new CKEDITOR.htmlParser.element("smiley",{desc:g[e]}),f),i=t+e.length}),i!=n.length&&o(new CKEDITOR.htmlParser.text(n.substring(i,n.length)),f))}))},c.parse(CKEDITOR.tools.htmlEncode(e));f.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT;)e=f.parent,o(f,e),f=e;return i};var C=new(CKEDITOR.tools.createClass({$:function(){this._={output:[],rules:[]},this.setRules("list",{breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1}),this.setRules("*",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:1,breakAfterClose:0}),this.setRules("quote",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:0,breakAfterClose:1})},proto:{setRules:function(e,t){var n=this._.rules[e];n?CKEDITOR.tools.extend(n,t,!0):this._.rules[e]=t},getRule:function(e,t){return this._.rules[e]&&this._.rules[e][t]},openTag:function(e){e in c&&(this.getRule(e,"breakBeforeOpen")&&this.lineBreak(1),this.write("[",e))},openTagClose:function(e){"br"==e?this._.output.push("\n"):e in c&&(this.write("]"),this.getRule(e,"breakAfterOpen")&&this.lineBreak(1))},attribute:function(e,t){"option"==e&&this.write("=",t)},closeTag:function(e){e in c&&(this.getRule(e,"breakBeforeClose")&&this.lineBreak(1),"*"!=e&&this.write("[/",e,"]"),this.getRule(e,"breakAfterClose")&&this.lineBreak(1))},text:function(e){this.write(e)},comment:function(){},lineBreak:function(){!this._.hasLineBreak&&this._.output.length&&(this.write("\n"),this._.hasLineBreak=1)},write:function(){this._.hasLineBreak=0;var e=Array.prototype.join.call(arguments,"");this._.output.push(e)},reset:function(){this._.output=[],this._.hasLineBreak=0},getHtml:function(e){var t=this._.output.join("");return e&&this.reset(),n(t)}}}));CKEDITOR.plugins.add("bbcode",{requires:"entities",beforeInit:function(e){CKEDITOR.tools.extend(e.config,{enterMode:CKEDITOR.ENTER_BR,basicEntities:!1,entities:!1,fillEmptyBlocks:!1},!0),e.filter.disable(),e.activeEnterMode=e.enterMode=CKEDITOR.ENTER_BR},init:function(o){function e(e){var t=e.data;e=CKEDITOR.htmlParser.fragment.fromBBCode(e.data.dataValue);var n=new CKEDITOR.htmlParser.basicWriter;e.writeHtml(n,r),e=n.getHtml(!0),t.dataValue=e}var i=o.config,r=new CKEDITOR.htmlParser.filter;r.addRules({elements:{blockquote:function(e){var t,n=new CKEDITOR.htmlParser.element("div");n.children=e.children,e.children=[n],(n=e.attributes.cite)&&((t=new CKEDITOR.htmlParser.element("cite")).add(new CKEDITOR.htmlParser.text(n.replace(/^"|"$/g,""))),delete e.attributes.cite,e.children.unshift(t))},span:function(e){var t;(t=e.attributes.bbcode)&&("img"==t?(e.name="img",e.attributes.src=e.children[0].value,e.children=[]):"email"==t&&(e.name="a",e.attributes.href="mailto:"+e.children[0].value),delete e.attributes.bbcode)},ol:function(e){e.attributes.listType?"decimal"!=e.attributes.listType&&(e.attributes.style="list-style-type:"+e.attributes.listType):e.name="ul",delete e.attributes.listType},a:function(e){e.attributes.href||(e.attributes.href=e.children[0].value)},smiley:function(e){e.name="img";var t=e.attributes.desc,n=i.smiley_images[CKEDITOR.tools.indexOf(i.smiley_descriptions,t)],n=CKEDITOR.tools.htmlEncode(i.smiley_path+n);e.attributes={src:n,"data-cke-saved-src":n,title:t,alt:t}}}}),o.dataProcessor.htmlFilter.addRules({elements:{$:function(e){var t,n=e.attributes,i=CKEDITOR.tools.parseCssText(n.style,1),r=e.name;if(r in u)r=u[r];else if("span"==r)(t=i.color)?(r="color",t=CKEDITOR.tools.convertRgbToHex(t)):(t=i["font-size"])&&(n=t.match(/(\d+)%$/))&&(t=n[1],r="size");else if("ol"==r||"ul"==r){if(t=i["list-style-type"])switch(t){case"lower-alpha":t="a";break;case"upper-alpha":t="A"}else"ol"==r&&(t=1);r="list"}else if("blockquote"==r){try{var s=e.children[0],a=e.children[1],l="cite"==s.name&&s.children[0].value;l&&(t='"'+l+'"',e.children=a.children)}catch(e){}r="quote"}else if("a"==r)(t=n.href)&&(-1!==t.indexOf("mailto:")?(r="email",e.children=[new CKEDITOR.htmlParser.text(t.replace("mailto:",""))],t=""):((r=1==e.children.length&&e.children[0])&&r.type==CKEDITOR.NODE_TEXT&&r.value==t&&(t=""),r="url"));else if("img"==r){if(e.isEmpty=0,i=n["data-cke-saved-src"]||n.src,n=n.alt,i&&-1!=i.indexOf(o.config.smiley_path)&&n)return new CKEDITOR.htmlParser.text(p[n]);e.children=[new CKEDITOR.htmlParser.text(i)]}return e.name=r,t&&(e.attributes.option=t),null},div:function(e){var t=CKEDITOR.tools.parseCssText(e.attributes.style,1)["text-align"]||"";if(t)return e.name=t,null},br:function(e){if((e=e.next)&&e.name in d)return!1}}},1),o.dataProcessor.writer=C,o.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?o.once("contentDom",function(){o.on("setData",e)}):o.on("setData",e)},afterInit:function(i){var e;i._.elementsPath&&(e=i._.elementsPath.filters)&&e.push(function(e){var t=e.getName(),n=s[t]||!1;return"link"==n&&0===e.getAttribute("href").indexOf("mailto:")?n="email":"span"==t?e.getStyle("font-size")?n="size":e.getStyle("color")&&(n="color"):"div"==t&&e.getStyle("text-align")?n=e.getStyle("text-align"):"img"==n&&(e=e.data("cke-saved-src")||e.getAttribute("src"))&&0===e.indexOf(i.config.smiley_path)&&(n="smiley"),n})}})}();