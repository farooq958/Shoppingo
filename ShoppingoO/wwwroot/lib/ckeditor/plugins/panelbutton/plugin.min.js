CKEDITOR.plugins.add("panelbutton",{requires:"button",onLoad:function(){function n(t){var e=this._;e.state!=CKEDITOR.TRISTATE_DISABLED&&(this.createPanel(t),e.on?e.panel.hide():e.panel.showBlock(this._.id,this.document.getById(this._.id),4))}CKEDITOR.ui.panelButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(t){var e=t.panel||{};delete t.panel,this.base(t),this.document=e.parent&&e.parent.getDocument()||CKEDITOR.document,e.block={attributes:e.attributes},e.toolbarRelated=!0,this.hasArrow="listbox",this.click=n,this._={panelDefinition:e}},statics:{handler:{create:function(t){return new CKEDITOR.ui.panelButton(t)}}},proto:{createPanel:function(e){var t,n,o,a,s,i,l=this._;l.panel||(a=this._.panelDefinition,t=this._.panelDefinition.block,n=a.parent||CKEDITOR.document.getBody(),a=(o=this._.panel=new CKEDITOR.ui.floatPanel(e,n,a)).addBlock(l.id,t),i=e.getCommand((s=this).command),o.onShow=function(){s.className&&this.element.addClass(s.className+"_panel"),s.setState(CKEDITOR.TRISTATE_ON),l.on=1,s.editorFocus&&e.focus(),s.onOpen&&s.onOpen()},o.onHide=function(t){s.className&&this.element.getFirst().removeClass(s.className+"_panel"),!s.modes&&i?s.setStateFromCommand(i):s.setState(s.modes&&s.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),l.on=0,!t&&s.onClose&&s.onClose()},o.onEscape=function(){o.hide(1),s.document.getById(l.id).focus()},this.onBlock&&this.onBlock(o,a),a.onHide=function(){l.on=0,!s.modes&&s.command?s.setStateFromCommand(i):s.setState(CKEDITOR.TRISTATE_OFF)})},setStateFromCommand:function(t){this.setState(t.state)}}})},beforeInit:function(t){t.ui.addHandler(CKEDITOR.UI_PANELBUTTON,CKEDITOR.ui.panelButton.handler)}}),CKEDITOR.UI_PANELBUTTON="panelbutton";