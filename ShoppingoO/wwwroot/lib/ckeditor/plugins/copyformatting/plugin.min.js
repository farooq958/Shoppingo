!function(){function l(e,t,n,o){var a=new CKEDITOR.dom.walker(e);if(!(e=e.startContainer.getAscendant(t,!0)||e.endContainer.getAscendant(t,!0))||(n(e),!o))for(;(e=a.next())&&(!(e=e.getAscendant(t,!0))||(n(e),!o)););}function e(e){this.styles=null,this.sticky=!1,this.editor=e,this.filter=new CKEDITOR.filter(e,e.config.copyFormatting_allowRules),!0===e.config.copyFormatting_allowRules&&(this.filter.disabled=!0),e.config.copyFormatting_disallowRules&&this.filter.disallow(e.config.copyFormatting_disallowRules)}var g=CKEDITOR.tools.indexOf,a=CKEDITOR.tools.getMouseButton,t=!1;CKEDITOR.plugins.add("copyformatting",{lang:"ar,az,bg,cs,da,de,de-ch,el,en,en-au,eo,es-mx,et,eu,fa,fr,gl,hr,hu,it,ja,ko,ku,lv,nb,nl,oc,pl,pt,pt-br,ro,ru,sk,sq,sr,sr-latn,sv,tr,uk,vi,zh,zh-cn",icons:"copyformatting",hidpi:!0,init:function(i){var l=CKEDITOR.plugins.copyformatting;l._addScreenReaderContainer(),t||(CKEDITOR.document.appendStyleSheet(this.path+"styles/copyformatting.css"),t=!0),i.addContentsCss&&i.addContentsCss(this.path+"styles/copyformatting.css"),i.copyFormatting=new l.state(i),i.addCommand("copyFormatting",l.commands.copyFormatting),i.addCommand("applyFormatting",l.commands.applyFormatting),i.ui.addButton("CopyFormatting",{label:i.lang.copyformatting.label,command:"copyFormatting",toolbar:"cleanup,0"}),i.on("contentDom",function(){var t=i.getCommand("copyFormatting"),n=i.editable(),e=n.isInline()?n:i.document,o=i.ui.get("CopyFormatting");n.attachListener(e,"mouseup",function(e){a(e)===CKEDITOR.MOUSE_BUTTON_LEFT&&t.state===CKEDITOR.TRISTATE_ON&&i.execCommand("applyFormatting")}),n.attachListener(CKEDITOR.document,"mouseup",function(e){a(e)!==CKEDITOR.MOUSE_BUTTON_LEFT||t.state!==CKEDITOR.TRISTATE_ON||n.contains(e.data.getTarget())||i.execCommand("copyFormatting")}),o&&(e=CKEDITOR.document.getById(o._.id),n.attachListener(e,"dblclick",function(){i.execCommand("copyFormatting",{sticky:!0})}),n.attachListener(e,"mouseup",function(e){e.data.stopPropagation()}))}),i.config.copyFormatting_keystrokeCopy&&i.setKeystroke(i.config.copyFormatting_keystrokeCopy,"copyFormatting"),i.on("key",function(e){var t=i.getCommand("copyFormatting");(e=e.data.domEvent).getKeystroke&&27===e.getKeystroke()&&t.state===CKEDITOR.TRISTATE_ON&&i.execCommand("copyFormatting")}),i.copyFormatting.on("extractFormatting",function(e){var t=e.data.element;return t.contains(i.editable())||t.equals(i.editable())?e.cancel():(t=l._convertElementToStyleDef(t),i.copyFormatting.filter.check(new CKEDITOR.style(t),!0,!0)?void(e.data.styleDef=t):e.cancel())}),i.copyFormatting.on("applyFormatting",function(e){if(!e.data.preventFormatStripping){var t,n,o=e.data.range,a=l._extractStylesFromRange(i,o),r=l._determineContext(o);if(i.copyFormatting._isContextAllowed(r))for(n=0;n<a.length;n++)r=a[n],t=o.createBookmark(),-1===g(l.preservedElements,r.element)?CKEDITOR.env.webkit&&!CKEDITOR.env.chrome?a[n].removeFromRange(e.data.range,e.editor):a[n].remove(e.editor):function(t,e){var n={ul:"ol",ol:"ul"};return-1!==g(e,function(e){return e.element===t||e.element===n[t]})}(r.element,e.data.styles)&&l._removeStylesFromElementInRange(o,r.element),o.moveToBookmark(t)}}),i.copyFormatting.on("applyFormatting",function(e){var t=CKEDITOR.plugins.copyformatting,n=t._determineContext(e.data.range);"list"===n&&i.copyFormatting._isContextAllowed("list")?t._applyStylesToListContext(e.editor,e.data.range,e.data.styles):"table"===n&&i.copyFormatting._isContextAllowed("table")?t._applyStylesToTableContext(e.editor,e.data.range,e.data.styles):i.copyFormatting._isContextAllowed("text")&&t._applyStylesToTextContext(e.editor,e.data.range,e.data.styles)},null,null,999)}}),e.prototype._isContextAllowed=function(e){var t=this.editor.config.copyFormatting_allowedContexts;return!0===t||-1!==g(t,e)},CKEDITOR.event.implementOn(e.prototype),CKEDITOR.plugins.copyformatting={state:e,inlineBoundary:"h1 h2 h3 h4 h5 h6 p div".split(" "),excludedAttributes:["id","style","href","data-cke-saved-href","dir"],elementsForInlineTransform:["li"],excludedElementsFromInlineTransform:["table","thead","tbody","ul","ol"],excludedAttributesFromInlineTransform:["value","type"],preservedElements:"ul ol li td th tr thead tbody table".split(" "),breakOnElements:["ul","ol","table"],_initialKeystrokePasteCommand:null,commands:{copyFormatting:{exec:function(e,t){var n=CKEDITOR.plugins.copyformatting,o=e.copyFormatting,a=!!t&&"keystrokeHandler"==t.from,r=!!t&&(t.sticky||a),i=n._getCursorContainer(e),t=CKEDITOR.document.getDocumentElement();if(this.state===CKEDITOR.TRISTATE_ON)return o.styles=null,o.sticky=!1,i.removeClass("cke_copyformatting_active"),t.removeClass("cke_copyformatting_disabled"),t.removeClass("cke_copyformatting_tableresize_cursor"),n._putScreenReaderMessage(e,"canceled"),n._detachPasteKeystrokeHandler(e),this.setState(CKEDITOR.TRISTATE_OFF);o.styles=n._extractStylesFromElement(e,e.elementPath().lastElement),this.setState(CKEDITOR.TRISTATE_ON),a||(i.addClass("cke_copyformatting_active"),t.addClass("cke_copyformatting_tableresize_cursor"),e.config.copyFormatting_outerCursor&&t.addClass("cke_copyformatting_disabled")),o.sticky=r,n._putScreenReaderMessage(e,"copied"),n._attachPasteKeystrokeHandler(e)}},applyFormatting:{editorFocus:!(CKEDITOR.env.ie&&!CKEDITOR.env.edge),exec:function(e,t){var n=e.getCommand("copyFormatting"),o=!!t&&"keystrokeHandler"==t.from,a=CKEDITOR.plugins.copyformatting,r=e.copyFormatting,i=a._getCursorContainer(e),t=CKEDITOR.document.getDocumentElement();if(o&&!r.styles)return a._putScreenReaderMessage(e,"failed"),a._detachPasteKeystrokeHandler(e),!1;o=a._applyFormat(e,r.styles),r.sticky||(r.styles=null,i.removeClass("cke_copyformatting_active"),t.removeClass("cke_copyformatting_disabled"),t.removeClass("cke_copyformatting_tableresize_cursor"),n.setState(CKEDITOR.TRISTATE_OFF),a._detachPasteKeystrokeHandler(e)),a._putScreenReaderMessage(e,o?"applied":"canceled")}}},_getCursorContainer:function(e){return e.elementMode===CKEDITOR.ELEMENT_MODE_INLINE?e.editable():e.editable().getParent()},_convertElementToStyleDef:function(e){var t=CKEDITOR.tools,n=e.getAttributes(CKEDITOR.plugins.copyformatting.excludedAttributes),t=t.parseCssText(e.getAttribute("style"),!0,!0);return{element:e.getName(),type:CKEDITOR.STYLE_INLINE,attributes:n,styles:t}},_extractStylesFromElement:function(e,t){var n={},o=[];do{if(t.type===CKEDITOR.NODE_ELEMENT&&!t.hasAttribute("data-cke-bookmark")&&(n.element=t,e.copyFormatting.fire("extractFormatting",n,e)&&n.styleDef&&o.push(new CKEDITOR.style(n.styleDef)),t.getName&&-1!==g(CKEDITOR.plugins.copyformatting.breakOnElements,t.getName())))break}while((t=t.getParent())&&t.type===CKEDITOR.NODE_ELEMENT);return o},_extractStylesFromRange:function(e,t){for(var n,o=[],a=new CKEDITOR.dom.walker(t);n=a.next();)o=o.concat(CKEDITOR.plugins.copyformatting._extractStylesFromElement(e,n));return o},_removeStylesFromElementInRange:function(e,t){for(var n,o=-1!==g(["ol","ul","table"],t),a=new CKEDITOR.dom.walker(e);(n=a.next())&&(!(n=n.getAscendant(t,!0))||(n.removeAttributes(n.getAttributes()),!o)););},_getSelectedWordOffset:function(e){function c(e,t){return e[t?"getPrevious":"getNext"](function(e){return e.type!==CKEDITOR.NODE_COMMENT})}function m(e){return e.type==CKEDITOR.NODE_ELEMENT?(e=e.getHtml().replace(/<span.*?>&nbsp;<\/span>/g,"")).replace(/<.*?>/g,""):e.getText()}function d(e,t){var n,o,a=e,r=/\s/g,i="p br ol ul li td th div caption body".split(" "),l=!1,s=!1;do{for(n=c(a,t);!n&&a.getParent();){if(a=a.getParent(),-1!==g(i,a.getName())){s=l=!0;break}n=c(a,t)}if(n&&n.getName&&-1!==g(i,n.getName())){l=!0;break}}while((a=n)&&a.getStyle&&("none"==a.getStyle("display")||!a.getText()));for(a=a||e;a.type!==CKEDITOR.NODE_TEXT;)a=!l||t||s?a.getChild(0):a.getChild(a.getChildCount()-1);for(i=m(a);null!=(s=r.exec(i))&&(o=s.index,t););if("number"!=typeof o&&!l)return d(a,t);if(l)o=t?0:(s=(r=/([\.\b]*$)/).exec(i))?s.index:i.length;else if(t&&(o+=1)>i.length)return d(a);return{node:a,offset:o}}for(var t,n,o,a=/\b\w+\b/gi,r=n=o=e.startContainer,i=m(r);null!=(t=a.exec(i));)if(t.index+t[0].length>=e.startOffset)return e=t.index,a=t.index+t[0].length,0===t.index&&(n=(t=d(r,!0)).node,e=t.offset),a>=i.length&&(o=(i=d(r)).node,a=i.offset),{startNode:n,startOffset:e,endNode:o,endOffset:a};return null},_filterStyles:function(e){for(var t,n=CKEDITOR.tools.isEmpty,o=[],a=0;a<e.length;a++)t=e[a]._.definition,-1!==CKEDITOR.tools.indexOf(CKEDITOR.plugins.copyformatting.inlineBoundary,t.element)&&(t.element=e[a].element="span"),"span"===t.element&&n(t.attributes)&&n(t.styles)||o.push(e[a]);return o},_determineContext:function(o){function e(e){var t,n=new CKEDITOR.dom.walker(o);if(o.startContainer.getAscendant(e,!0)||o.endContainer.getAscendant(e,!0))return 1;for(;t=n.next();)if(t.getAscendant(e,!0))return 1}return e({ul:1,ol:1})?"list":e("table")?"table":"text"},_applyStylesToTextContext:function(e,t,n){var o,a,r=CKEDITOR.plugins.copyformatting,i=r.excludedAttributesFromInlineTransform;for(CKEDITOR.env.webkit&&!CKEDITOR.env.chrome&&e.getSelection().selectRanges([t]),o=0;o<n.length;o++)if(t=n[o],-1===g(r.excludedElementsFromInlineTransform,t.element)){if(-1!==g(r.elementsForInlineTransform,t.element))for(t.element=t._.definition.element="span",a=0;a<i.length;a++)t._.definition.attributes[i[a]]&&delete t._.definition.attributes[i[a]];t.apply(e)}},_applyStylesToListContext:function(e,t,n){for(var o,a,r=0;r<n.length;r++)o=n[r],a=t.createBookmark(),"ol"===o.element||"ul"===o.element?l(t,{ul:1,ol:1},function(e){var t=o;e.getName()!==t.element&&e.renameNode(t.element),t.applyToObject(e)},!0):"li"===o.element?l(t,"li",function(e){o.applyToObject(e)}):CKEDITOR.plugins.copyformatting._applyStylesToTextContext(e,t,[o]),t.moveToBookmark(a)},_applyStylesToTableContext:function(e,t,n){function o(e,t){e.getName()!==t.element&&((t=t.getDefinition()).element=e.getName(),t=new CKEDITOR.style(t)),t.applyToObject(e)}for(var a,r,i=0;i<n.length;i++)a=n[i],r=t.createBookmark(),-1!==g(["table","tr"],a.element)?l(t,a.element,function(e){a.applyToObject(e)}):-1!==g(["td","th"],a.element)?l(t,{td:1,th:1},function(e){o(e,a)}):-1!==g(["thead","tbody"],a.element)?l(t,{thead:1,tbody:1},function(e){o(e,a)}):CKEDITOR.plugins.copyformatting._applyStylesToTextContext(e,t,[a]),t.moveToBookmark(r)},_applyFormat:function(e,t){var n,o,a=e.getSelection().getRanges()[0],r=CKEDITOR.plugins.copyformatting;if(!a)return!1;if(a.collapsed){if(o=e.getSelection().createBookmarks(),!(n=r._getSelectedWordOffset(a)))return;(a=e.createRange()).setStart(n.startNode,n.startOffset),a.setEnd(n.endNode,n.endOffset),a.select()}return t=r._filterStyles(t),!!e.copyFormatting.fire("applyFormatting",{styles:t,range:a,preventFormatStripping:!1},e)&&(o&&e.getSelection().selectBookmarks(o),!0)},_putScreenReaderMessage:function(e,t){var n=this._getScreenReaderContainer();n&&n.setText(e.lang.copyformatting.notification[t])},_addScreenReaderContainer:function(){return this._getScreenReaderContainer()?this._getScreenReaderContainer():CKEDITOR.env.ie6Compat||CKEDITOR.env.ie7Compat?void 0:CKEDITOR.document.getBody().append(CKEDITOR.dom.element.createFromHtml('<div class="cke_screen_reader_only cke_copyformatting_notification"><div aria-live="polite"></div></div>')).getChild(0)},_getScreenReaderContainer:function(){if(!CKEDITOR.env.ie6Compat&&!CKEDITOR.env.ie7Compat)return CKEDITOR.document.getBody().findOne(".cke_copyformatting_notification div[aria-live]")},_attachPasteKeystrokeHandler:function(e){var t=e.config.copyFormatting_keystrokePaste;t&&(this._initialKeystrokePasteCommand=e.keystrokeHandler.keystrokes[t],e.setKeystroke(t,"applyFormatting"))},_detachPasteKeystrokeHandler:function(e){var t=e.config.copyFormatting_keystrokePaste;t&&e.setKeystroke(t,this._initialKeystrokePasteCommand||!1)}},CKEDITOR.config.copyFormatting_outerCursor=!0,CKEDITOR.config.copyFormatting_allowRules="b s u i em strong span p div td th ol ul li(*)[*]{*}",CKEDITOR.config.copyFormatting_disallowRules="*[data-cke-widget*,data-widget*,data-cke-realelement](cke_widget*)",CKEDITOR.config.copyFormatting_allowedContexts=!0,CKEDITOR.config.copyFormatting_keystrokeCopy=CKEDITOR.CTRL+CKEDITOR.SHIFT+67,CKEDITOR.config.copyFormatting_keystrokePaste=CKEDITOR.CTRL+CKEDITOR.SHIFT+86}();