!function(){function f(e,t,n){t.is&&t.getCustomData("block_processed")||(t.is&&CKEDITOR.dom.element.setMarker(n,t,"block_processed",!0),e.push(t))}function t(c,m){var e,g=(e=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit),c.config.div_wrapTable&&(delete e.td,delete e.th),e),u=CKEDITOR.dtd.div,a={},h=[];return{title:c.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:c.lang.common.generalTab,title:c.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:c.lang.div.styleSelectLabel,default:"",items:[[c.lang.common.notSet,""]],onChange:function(){var e=["info:elementStyle","info:class","advanced:dir","advanced:style"],t=this.getDialog(),n=(n=t.getModel(c))&&n.clone()||new CKEDITOR.dom.element("div",c.document);this.commit(n,!0);for(var l,i=(e=[].concat(e)).length,o=0;o<i;o++)(l=t.getContentElement.apply(t,e[o].split(":")))&&l.setup&&l.setup(n,!0)},setup:function(e){for(var t in a)a[t].checkElementRemovable(e,!0,c)&&this.setValue(t,1)},commit:function(e){var t;(t=this.getValue())?a[t].applyToObject(e,c):e.removeAttribute("style")}},{id:"class",type:"text",requiredContent:"div(cke-xyz)",label:c.lang.common.cssClass,default:""}]}]},{id:"advanced",label:c.lang.common.advancedTab,title:c.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",requiredContent:"div[id]",label:c.lang.common.id,default:""},{type:"text",id:"lang",requiredContent:"div[lang]",label:c.lang.common.langCode,default:""}]},{type:"hbox",children:[{type:"text",id:"style",requiredContent:"div{cke-xyz}",style:"width: 100%;",label:c.lang.common.cssStyle,default:"",commit:function(e){e.setAttribute("style",this.getValue())}}]},{type:"hbox",children:[{type:"text",id:"title",requiredContent:"div[title]",style:"width: 100%;",label:c.lang.common.advisoryTitle,default:""}]},{type:"select",id:"dir",requiredContent:"div[dir]",style:"width: 100%;",label:c.lang.common.langDir,default:"",items:[[c.lang.common.notSet,""],[c.lang.common.langDirLtr,"ltr"],[c.lang.common.langDirRtl,"rtl"]]}]}]}],getModel:function(e){return"editdiv"===m?CKEDITOR.plugins.div.getSurroundDiv(e):null},onLoad:function(){!function(){this.foreach(function(n){/^(?!vbox|hbox)/.test(n.type)&&(n.setup||(n.setup=function(e){n.setValue(e.getAttribute(n.id)||"",1)}),n.commit||(n.commit=function(e){var t=this.getValue();"dir"==n.id&&e.getComputedStyle("direction")==t||(t?e.setAttribute(n.id,t):e.removeAttribute(n.id))}))})}.call(this);var i=this,o=this.getContentElement("info","elementStyle");c.getStylesSet(function(e){var t,n;if(e)for(var l=0;l<e.length;l++)(n=e[l]).element&&"div"==n.element&&(t=n.name,a[t]=n=new CKEDITOR.style(n),c.filter.check(n)&&(o.items.push([t,t]),o.add(t,t)));o[1<o.items.length?"enable":"disable"](),setTimeout(function(){var e=i.getModel(c);e&&o.setup(e)},0)})},onShow:function(){"editdiv"==m&&this.setupContent(this.getModel(c))},onOk:function(){if("editdiv"==m)h=[this.getModel(c)];else{for(var e,t=[],n={},l=[],i=c.getSelection(),o=i.getRanges(),a=i.createBookmarks(),d=0;d<o.length;d++)for(e=o[d].createIterator();s=e.getNextParagraph();)if(s.getName()in g&&!s.isReadOnly())for(var r=s.getChildren(),s=0;s<r.count();s++)f(l,r.getItem(s),n);else{for(;!u[s.getName()]&&!s.equals(o[d].root);)s=s.getParent();f(l,s,n)}for(CKEDITOR.dom.element.clearAllMarkers(n),o=[],d=null,e=0;e<l.length;e++)s=l[e],(r=c.elementPath(s).blockLimit).isReadOnly()&&(r=r.getParent()),(r=c.config.div_wrapTable&&r.is(["td","th"])?c.elementPath(r.getParent()).blockLimit:r).equals(d)||(d=r,o.push([])),s.getParent()&&o[o.length-1].push(s);for(d=0;d<o.length;d++)if(o[d].length){for(l=(r=o[d][0]).getParent(),s=1;s<o[d].length;s++)l=l.getCommonAncestor(o[d][s]);for(l=l||c.editable(),e=new CKEDITOR.dom.element("div",c.document),s=0;s<o[d].length;s++){for(r=o[d][s];r.getParent()&&!r.getParent().equals(l);)r=r.getParent();o[d][s]=r}for(s=0;s<o[d].length;s++)(r=o[d][s]).getCustomData&&r.getCustomData("block_processed")||(r.is&&CKEDITOR.dom.element.setMarker(n,r,"block_processed",!0),s||e.insertBefore(r),e.append(r));CKEDITOR.dom.element.clearAllMarkers(n),t.push(e)}i.selectBookmarks(a),h=t}for(t=h.length,n=0;n<t;n++)this.commitContent(h[n]),h[n].getAttribute("style")||h[n].removeAttribute("style");this.hide()},onHide:function(){this.getMode(c)===CKEDITOR.dialog.EDITING_MODE&&this.getModel(c).removeCustomData("elementStyle")}}}CKEDITOR.dialog.add("creatediv",function(e){return t(e,"creatediv")}),CKEDITOR.dialog.add("editdiv",function(e){return t(e,"editdiv")})}();