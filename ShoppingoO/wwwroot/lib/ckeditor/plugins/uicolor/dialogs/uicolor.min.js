CKEDITOR.dialog.add("uicolor",function(a){function s(e){var t;"td"==(e=e.data.getTarget()).getName()&&(t=e.getChild(0).getHtml())&&(n(),l(e),r(t))}function l(e){e&&((b=e).setAttribute("aria-selected",!0),b.addClass("cke_colordialog_selected"))}function n(){b&&(b.removeClass("cke_colordialog_selected"),b.removeAttribute("aria-selected"),b=null)}function r(e){p.getContentElement("picker","selectedColor").setValue(e),e||C.getById(I).removeStyle("background-color")}function d(e){e.name||(e=new CKEDITOR.event(e));var t,o=!/mouse/.test(e.name),l=e.data.getTarget();"td"==l.getName()&&(t=l.getChild(0).getHtml())&&(u(e),o?h=l:m=l,o&&l.addClass(function(e){e=e.replace(/^#/,"");for(var t=0,o=[];t<=2;t++)o[t]=parseInt(e.substr(2*t,2),16);return 165<=.2126*o[0]+.7152*o[1]+.0722*o[2]}(t)?"cke_colordialog_focused_light":"cke_colordialog_focused_dark"),i(t))}function u(e){(e=!/mouse/.test(e.name)&&h)&&(e.removeClass("cke_colordialog_focused_light"),e.removeClass("cke_colordialog_focused_dark")),h||m||i(!1)}function i(e){e?(C.getById(k).setStyle("background-color",e),C.getById(_).setHtml(e)):(C.getById(k).removeStyle("background-color"),C.getById(_).setHtml("&nbsp;"))}function g(e){var t=e.data,o=t.getTarget(),l=t.getKeystroke(),n="rtl"==a.lang.dir;switch(l){case 38:(e=o.getParent().getPrevious())&&(e=e.getChild([o.getIndex()])).focus(),t.preventDefault();break;case 40:(e=o.getParent().getNext())&&(e=e.getChild([o.getIndex()]))&&1==e.type&&e.focus(),t.preventDefault();break;case 32:case 13:s(e),t.preventDefault();break;case n?37:39:(e=o.getNext())?1==e.type&&(e.focus(),t.preventDefault(!0)):(e=o.getParent().getNext())&&(e=e.getChild([0]))&&1==e.type&&(e.focus(),t.preventDefault(!0));break;case n?39:37:(e=o.getPrevious())?(e.focus(),t.preventDefault(!0)):(e=o.getParent().getPrevious())&&((e=e.getLast()).focus(),t.preventDefault(!0))}}function f(e){return CKEDITOR.tools.getNextId()+"_"+e}function c(e){var t=null;return t=x&&e?x.findOne('td[data-color="'+e+'"]'):t}function t(e,t){var o=e||t;a.setUiColor(o),p.getContentElement("picker","configBox").setValue(o),e&&p.getContentElement("picker","predefined").getValue()!==o?p.getContentElement("picker","predefined").setValue(o):t&&((t=c(o))?l(t):n(),p.getContentElement("picker","selectedColor").getValue()!==o&&r(o))}function o(e){return e.getUiColor()?CKEDITOR.tools.parseCssText("color:"+e.getUiColor(),!0).color:null}var p,b,h,m,v=CKEDITOR.dom.element,C=CKEDITOR.document,y=a.lang.uicolor,k=f("hicolor"),_=f("hicolortext"),I=f("selhicolor"),x=function(){function e(e,t){for(var o=e;o<e+3;o++){var l=new v(i.$.insertRow(-1));l.setAttribute("role","row");for(var n=t;n<t+3;n++)for(var a=0;a<6;a++)r(l.$,"#"+c[n]+c[a]+c[o])}}function r(e,t){var o=new v(e.insertCell(-1));o.setAttribute("class","ColorCell cke_colordialog_colorcell"),o.setAttribute("tabIndex",-1),o.setAttribute("role","gridcell"),o.setAttribute("data-color",t),o.on("keydown",g),o.on("click",s),o.on("focus",d),o.on("blur",u),o.setStyle("background-color",t);e=f("color_table_cell");o.setAttribute("aria-labelledby",e),o.append(CKEDITOR.dom.element.createFromHtml('<span id="'+e+'" class="cke_voice_label">'+t+"</span>",CKEDITOR.document))}var i=CKEDITOR.dom.element.createFromHtml('<table tabIndex="-1" class="cke_colordialog_table" aria-label="'+y.options+'" role="grid" style="border-collapse:separate;" cellspacing="0"><caption class="cke_voice_label">'+y.options+'</caption><tbody role="presentation"></tbody></table>');i.on("mouseover",d),i.on("mouseout",u);var c="00 33 66 99 cc ff".split(" ");e(0,0),e(3,0),e(0,3),e(3,3);var t=new v(i.$.insertRow(-1));t.setAttribute("role","row"),r(t.$,"#000000");for(var o=0;o<16;o++){var l=o.toString(16);r(t.$,"#"+l+l+l+l+l+l)}return r(t.$,"#ffffff"),i}();return CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(CKEDITOR.plugins.get("uicolor").path+"dialogs/uicolor.css")),{title:y.title,minWidth:360,minHeight:220,buttons:[CKEDITOR.dialog.okButton],onLoad:function(){p=this},onHide:function(){n(),r(null),h&&(h.removeClass("cke_colordialog_focused_light"),h.removeClass("cke_colordialog_focused_dark"),i(h=null))},contents:[{id:"picker",label:y.title,accessKey:"I",elements:[{type:"hbox",padding:0,widths:["70%","10%","30%"],children:[{type:"html",html:"<div></div>",onLoad:function(){CKEDITOR.document.getById(this.domId).append(x)},focus:function(){var e=o(a),t=e?c(e):h||this.getElement().getElementsByTag("td").getItem(0);t&&(t.focus(),e&&(l(t),r(e)))}},{type:"html",html:"&nbsp;"},{type:"vbox",padding:0,widths:["70%","5%","25%"],children:[{type:"html",html:"<span>"+y.highlight+'</span><div id="'+k+'" style="border: 1px solid; height: 74px; width: 74px;"></div><div id="'+_+'">&nbsp;</div><span>'+y.selected+'</span><div id="'+I+'" style="border: 1px solid; height: 20px; width: 74px;"></div>'},{type:"text",label:y.selected,labelStyle:"display:none",id:"selectedColor",style:"width: 76px;margin-top:4px",onChange:function(){try{var e=this.getValue();e&&(C.getById(I).setStyle("background-color",e),t(e))}catch(e){n(),r(null)}}}]}]},{type:"vbox",children:[{type:"hbox",padding:0,children:[{id:"predefined",type:"select",default:"",width:"100%",label:y.predefined,items:[[""],["Light blue","#9ab8f3"],["Sand","#d2b48c"],["Metallic","#949aaa"],["Purple","#c2a3c7"],["Olive","#a2c980"],["Happy green","#9bd446"],["Jezebel Blue","#14b8c4"],["Burn","#ff89a"],["Easy red","#ff6969"],["Pisces 3","#48b4f2"],["Aquarius 5","#487ed4"],["Absinthe","#a8cf76"],["Scrambled Egg","#c7a622"],["Hello monday","#8e8d80"],["Lovely sunshine","#f1e8b1"],["Recycled air","#b3c593"],["Down","#bcbca4"],["Mark Twain","#cfe91d"],["Specks of dust","#d1b596"],["Lollipop","#f6ce23"]],onShow:function(){this.setValue(o(a))},onChange:function(){var e=this.getValue();e&&(t(null,e),this.focus())}}]},{id:"configBox",type:"text",label:y.config,onShow:function(){this.getInputElement().setAttribute("readonly",!0),this.setValue(o(a))},onChange:function(){var e=this.getValue();e&&CKEDITOR.tools.style.parse._findColor(e).length&&this.setValue('config.uiColor = "'+e.toLowerCase()+'"',!0)}}]}]}]}});