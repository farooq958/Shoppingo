!function(){function g(e){return CKEDITOR.tools.capitalize(e,!0)}function c(l,e){function o(s){return function(e,a){var t=e.widgets.focused,i=CKEDITOR.TRISTATE_DISABLED;t&&"easyimage"===t.name&&(i=s&&s.call(this,t,e,a)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),this.setState(i)}}l.addCommand("easyimageAlt",new CKEDITOR.dialogCommand("easyimageAlt",{startDisabled:!0,contextSensitive:!0,refresh:o()})),function(a){function t(e,a){var t=e.match(/^easyimage(.+)$/);if(t){e=(t[1][0]||"").toLowerCase()+t[1].substr(1);if(t[1]in a)return t[1];if(e in a)return e}}for(var e in l.on("afterCommandExec",function(e){t(e.data.name,a)&&(l.forceNextSelectionCheck(),l.selectionChange(!0))}),l.on("beforeCommandExec",function(e){t(e.data.name,a)&&e.data.command.style.checkActive(e.editor.elementPath(),l)&&(e.cancel(),l.focus())}),a)i=l,s=e,n=a[e],e="easyimage"+g(e),n.type="widget",n.widget="easyimage",n.group=n.group||"easyimage",n.element="figure",s=new CKEDITOR.style(n),i.filter.allow(s),(s=new CKEDITOR.styleCommand(s)).contextSensitive=!0,s.refresh=o(function(e,a,t){return this.style.checkActive(t,a)}),i.addCommand(e,s),(s=i.getCommand(e)).enable=function(){},s.refresh(i,i.elementPath());var i,s,n}(e)}function u(a){var t=a.sender.editor,e=t.config.easyimage_toolbar;e.split&&(e=e.split(",")),CKEDITOR.tools.array.forEach(e,function(e){e=t.ui.items[e],a.data[e.name]=t.getCommand(e.command).state})}var a=!1,f=["jpeg","png","gif","bmp"];CKEDITOR.plugins.easyimage={_parseSrcSet:function(e){var a,t=[];for(a in e)"default"!==a&&t.push(e[a]+" "+a+"w");return t.join(", ")}},CKEDITOR.plugins.add("easyimage",{requires:"imagebase,balloontoolbar,button,dialog,cloudservices",lang:"ar,az,bg,cs,da,de,de-ch,en,en-au,et,fa,fr,gl,hr,hu,it,ku,lv,nb,nl,no,pl,pt,pt-br,ro,ru,sk,sq,sr,sr-latn,sv,tr,tt,uk,zh,zh-cn",icons:"easyimagefull,easyimageside,easyimagealt,easyimagealignleft,easyimagealigncenter,easyimagealignright,easyimageupload",hidpi:!0,onLoad:function(){CKEDITOR.dialog.add("easyimageAlt",this.path+"dialogs/easyimagealt.js")},isSupportedEnvironment:function(){return!CKEDITOR.env.ie||11<=CKEDITOR.env.version},init:function(e){this.isSupportedEnvironment()&&(a||(CKEDITOR.document.appendStyleSheet(this.path+"styles/easyimage.css"),a=!0),e.addContentsCss&&e.addContentsCss(this.path+"styles/easyimage.css"))},afterInit:function(e){if(this.isSupportedEnvironment()){var a,t=CKEDITOR.tools.object.merge({full:{attributes:{class:"easyimage-full"},label:e.lang.easyimage.commands.fullImage},side:{attributes:{class:"easyimage-side"},label:e.lang.easyimage.commands.sideImage},alignLeft:{attributes:{class:"easyimage-align-left"},label:e.lang.common.alignLeft},alignCenter:{attributes:{class:"easyimage-align-center"},label:e.lang.common.alignCenter},alignRight:{attributes:{class:"easyimage-align-right"},label:e.lang.common.alignRight}},e.config.easyimage_styles);for(a in l=t,o=(r=(n=e).config).easyimage_class,r={name:"easyimage",allowedContent:{figure:{classes:r.easyimage_sideClass},img:{attributes:"!src,srcset,alt,width,sizes"}},requiredContent:"figure; img[!src]",styleableElements:"figure",supportedTypes:new RegExp("image/("+f.join("|")+")","i"),loaderType:CKEDITOR.plugins.cloudservices.cloudServicesLoader,progressReporterType:CKEDITOR.plugins.imagebase.progressBar,upcasts:{figure:function(e){if((!o||e.hasClass(o))&&1===e.find("img",!0).length)return e}},init:function(){function i(e,a){var t=e.$;if(t.complete&&t.naturalWidth)return a(t.naturalWidth);e.once("load",function(){return t.naturalWidth?void a(t.naturalWidth):(t.src=t.src,i(e,a))})}var e=this.parts.image,a=e&&e.$.complete&&!e.$.naturalWidth;(e&&!e.$.complete||a)&&(a&&(e.$.src=e.$.src),i(e,function(){n._.easyImageToolbarContext.toolbar.reposition()})),void 0!==(e=this.element.data("cke-upload-id"))&&(this.setData("uploadId",e),this.element.data("cke-upload-id",!1)),this.on("contextMenu",u),n.config.easyimage_class&&this.addClass(n.config.easyimage_class),this.on("uploadStarted",function(){var a=this;i(a.parts.image,function(e){a.parts.image.hasAttribute("width")||(a.editor.fire("lockSnapshot"),a.parts.image.setAttribute("width",e),a.editor.fire("unlockSnapshot"))})}),this.on("uploadDone",function(e){e=e.data.loader.responseData.response;var a=CKEDITOR.plugins.easyimage._parseSrcSet(e);this.parts.image.setAttributes({"data-cke-saved-src":e.default,src:e.default,srcset:a,sizes:"100vw"})}),this.on("uploadFailed",function(){alert(this.editor.lang.easyimage.uploadFailed)}),this._loadDefaultStyle()},_loadDefaultStyle:function(){var e,a=!1,t=n.config.easyimage_defaultStyle;for(e in l){var i=n.getCommand("easyimage"+g(e));!a&&i&&i.style&&-1!==CKEDITOR.tools.array.indexOf(i.style.group,"easyimage")&&this.checkStyleActive(i.style)&&(a=!0)}!a&&t&&n.getCommand("easyimage"+g(t))&&this.applyStyle(n.getCommand("easyimage"+g(t)).style)}},o&&(r.requiredContent+="(!"+o+")",r.allowedContent.figure.classes="!"+o+","+r.allowedContent.figure.classes),n.plugins.link&&(r=CKEDITOR.plugins.imagebase.addFeature(n,"link",r)),r=CKEDITOR.plugins.imagebase.addFeature(n,"upload",r),r=CKEDITOR.plugins.imagebase.addFeature(n,"caption",r),CKEDITOR.plugins.imagebase.addImageWidget(n,"easyimage",r),m=e,d=new RegExp("<img[^>]*\\ssrc=[\\'\\\"]?data:image/("+f.join("|")+");base64,","i"),m.on("paste",function(e){if(!m.isReadOnly&&d.test(e.data.dataValue)){e=e.data;var a,t,i,s=document.implementation.createHTMLDocument(""),s=new CKEDITOR.dom.element(s.body),n=m.widgets.registered.easyimage,l=0;for(s.data("cke-editable",1),s.appendHtml(e.dataValue),t=s.find("img"),i=0;i<t.count();i++){var o,r=(a=(o=t.getItem(i)).getAttribute("src"))&&"data:"==a.substring(0,5),g=null===o.data("cke-realelement");r&&g&&!o.isReadOnly(1)&&(1<++l&&((r=m.getSelection().getRanges())[0].enlarge(CKEDITOR.ENLARGE_ELEMENT),r[0].collapse(!1)),a.match(/image\/([a-z]+?);/i),r=n._spawnLoader(m,a,n),(a=n._insertWidget(m,n,a,!1,{uploadId:r.id})).data("cke-upload-id",r.id),a.replace(o))}e.dataValue=s.getHtml()}}),c(e,t),e.ui.addButton("EasyImageAlt",{label:e.lang.easyimage.commands.altText,command:"easyimageAlt",toolbar:"easyimage,3"}),t)e.ui.addButton("EasyImage"+g(a),{label:t[a].label,command:"easyimage"+g(a),toolbar:"easyimage,99",icon:t[a].icon,iconHiDpi:t[a].iconHiDpi});r=(s=e).config.easyimage_toolbar,s.plugins.contextmenu&&(r.split&&(r=r.split(",")),s.addMenuGroup("easyimage"),CKEDITOR.tools.array.forEach(r,function(e){e=s.ui.items[e],s.addMenuItem(e.name,{label:e.label,command:e.command,group:"easyimage"})})),t=e.config.easyimage_toolbar,e._.easyImageToolbarContext=e.balloonToolbars.create({buttons:t.join?t.join(","):t,widgets:["easyimage"]}),(i=e).ui.addButton("EasyImageUpload",{label:i.lang.easyimage.commands.upload,command:"easyimageUpload",toolbar:"insert,1"}),i.addCommand("easyimageUpload",{exec:function(){var e=CKEDITOR.dom.element.createFromHtml('<input type="file" accept="image/*" multiple="multiple">');e.once("change",function(e){(e=e.data.getTarget()).$.files.length&&i.fire("paste",{method:"paste",dataValue:"",dataTransfer:new CKEDITOR.plugins.clipboard.dataTransfer({files:e.$.files})})}),e.$.click()}})}var i,s,m,d,n,l,o,r}}),CKEDITOR.config.easyimage_class="easyimage",CKEDITOR.config.easyimage_styles={},CKEDITOR.config.easyimage_defaultStyle="full",CKEDITOR.config.easyimage_toolbar=["EasyImageFull","EasyImageSide","EasyImageAlt"]}();