!function(){function o(e){var t=CKEDITOR.plugins.pastetools.filters.common.rtf,r=[];if(e=t.removeGroups(e,"(?:(?:header|footer)[lrf]?|nonshppict|shprslt)"),!(e=t.getGroups(e,"pict")))return r;for(var a,i,n=0;n<e.length;n++){var o=e[n].content,s=(i=void 0,i=(a=o).match(/\\blipuid (\w+)\}/),a=a.match(/\\bliptag(-?\d+)/),i?i[1]:a?a[1]:null),p=c(o),l=function(t){return"string"!=typeof t?-1:CKEDITOR.tools.array.indexOf(r,function(e){return e.id===t})}(s),g=(u=-1!==l&&r[l].hex)&&r[l].type===p,u=u&&r[l].type!==p&&l===r.length-1,m=-1!==o.indexOf("\\defshp"),f=-1!==CKEDITOR.tools.array.indexOf(CKEDITOR.pasteFilters.image.supportedImageTypes,p);g?r.push(r[l]):u||m||(o={id:s,hex:f?t.extractGroupContent(o).replace(/\s/g,""):null,type:p},-1!==l?r.splice(l,1,o):r.push(o))}return r}function s(e){for(var t,r=/<img[^>]+src="([^"]+)[^>]+/g,a=[];t=r.exec(e);)a.push(t[1]);return a}function c(t){var e=CKEDITOR.tools.array.find(CKEDITOR.pasteFilters.image.recognizableImageTypes,function(e){return e.marker.test(t)});return e?e.type:"unknown"}function p(e){var t=-1!==CKEDITOR.tools.array.indexOf(CKEDITOR.pasteFilters.image.supportedImageTypes,e.type),r=e.hex;return t?("string"==typeof r&&(r=CKEDITOR.tools.convertHexStringToBytes(e.hex)),e.type?"data:"+e.type+";base64,"+CKEDITOR.tools.convertBytesToBase64(r):null):null}function l(e){return new CKEDITOR.tools.promise(function(t){CKEDITOR.ajax.load(e,function(e){e=p({type:r(e=new Uint8Array(e)),hex:e}),t(e)},"arraybuffer")})}function r(e){e=e.subarray(0,4);var t=CKEDITOR.tools.array.map(e,function(e){return e.toString(16)}).join("");return(e=CKEDITOR.tools.array.find(CKEDITOR.pasteFilters.image.recognizableImageSignatures,function(e){return 0===t.indexOf(e.signature)}))?e.type:null}CKEDITOR.pasteFilters.image=function(e,t,r){var a,i,n;return t.activeFilter&&!t.activeFilter.check("img[src]")||0===(i=s(e)).length?e:r?function(e,t,r){var a,i,n;if(0===(t=o(t)).length)return e;if(a=CKEDITOR.tools.array.map(t,p,this),r.length!==a.length)return CKEDITOR.error("pastetools-failed-image-extraction",{rtf:t.length,html:r.length}),e;for(i=0;i<r.length;i++)0===r[i].indexOf("file://")&&(a[i]?(n=r[i].replace(/\\/g,"\\\\"),e=e.replace(new RegExp("(<img [^>]*src=[\"']?)"+n),"$1"+a[i])):CKEDITOR.error("pastetools-unsupported-image",{type:t[i].type,index:i}));return e}(e,r,i):(a=t,e=e,i=i,n=CKEDITOR.tools.array.unique(CKEDITOR.tools.array.filter(i,function(e){return e.match(/^blob:/i)})),i=CKEDITOR.tools.array.map(n,l),CKEDITOR.tools.promise.all(i).then(function(e){CKEDITOR.tools.array.forEach(e,function(t,e){var r;t?(r=n[e],r=a.editable().find('img[src="'+r+'"]').toArray(),CKEDITOR.tools.array.forEach(r,function(e){e.setAttribute("src",t),e.setAttribute("data-cke-saved-src",t)},this)):CKEDITOR.error("pastetools-unsupported-image",{type:"blob",index:e})})}),e)},CKEDITOR.pasteFilters.image.extractFromRtf=o,CKEDITOR.pasteFilters.image.extractTagsFromHtml=s,CKEDITOR.pasteFilters.image.getImageType=c,CKEDITOR.pasteFilters.image.createSrcWithBase64=p,CKEDITOR.pasteFilters.image.convertBlobUrlToBase64=l,CKEDITOR.pasteFilters.image.getImageTypeFromSignature=r,CKEDITOR.pasteFilters.image.supportedImageTypes=["image/png","image/jpeg","image/gif"],CKEDITOR.pasteFilters.image.recognizableImageTypes=[{marker:/\\pngblip/,type:"image/png"},{marker:/\\jpegblip/,type:"image/jpeg"},{marker:/\\emfblip/,type:"image/emf"},{marker:/\\wmetafile\d/,type:"image/wmf"}],CKEDITOR.pasteFilters.image.recognizableImageSignatures=[{signature:"ffd8ff",type:"image/jpeg"},{signature:"47494638",type:"image/gif"},{signature:"89504e47",type:"image/png"}]}();