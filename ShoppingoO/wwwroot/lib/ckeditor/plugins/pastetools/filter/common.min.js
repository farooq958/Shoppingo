!function(){function i(t,e,r){for(var n=t[e+=r],o=/[\s]/;n&&o.test(n);)n=t[e+=r];return n}function r(t){return/%$/.test(t)?t:t+"px"}function g(t){var e,r,n=t.margin?"margin":!!t.MARGIN&&"MARGIN";if(n){for(e in r=CKEDITOR.tools.style.parse.margin(t[n]))t["margin-"+e]=r[e];delete t[n]}}var d,p=CKEDITOR.tools,b={};(CKEDITOR.plugins.pastetools.filters.common=b).rules=function(t,i,a){var e,n=!(!(e=(e=i).config.font_names)||!e.length)&&(!!(e=CKEDITOR.tools.array.map(e.split(";"),function(t){return-1===t.indexOf("/")?t:t.split("/")[1]})).length&&e);return{elements:{"^":function(t){var e;!function(t){var e,r,n="background-color:transparent;background:transparent;background-color:none;background:none;background-position:initial initial;background-repeat:initial initial;caret-color;font-family:-webkit-standard;font-variant-caps;letter-spacing:normal;orphans;widows;text-transform:none;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;text-indent:0px;margin-bottom:0in".split(";"),o=CKEDITOR.tools.parseCssText(t.attributes.style);for(e in o)r=e+":"+o[e],CKEDITOR.tools.array.some(n,function(t){return r.substring(0,t.length).toLowerCase()===t})&&delete o[e];""!==(o=CKEDITOR.tools.writeCssText(o))?t.attributes.style=o:delete t.attributes.style}(t),t.attributes.bgcolor&&((e=CKEDITOR.tools.parseCssText(t.attributes.style))["background-color"]||(e["background-color"]=t.attributes.bgcolor,t.attributes.style=CKEDITOR.tools.writeCssText(e)))},span:function(t){if(t.hasClass("Apple-converted-space"))return new CKEDITOR.htmlParser.text(" ")},table:function(t){t.filterChildren(a);var e,r,n=t.parent,o=n&&n.parent;if(n.name&&"div"===n.name&&n.attributes.align&&1===p.object.keys(n.attributes).length&&1===n.children.length){for(t.attributes.align=n.attributes.align,e=n.children.splice(0),t.remove(),r=e.length-1;0<=r;r--)o.add(e[r],n.getIndex());n.remove()}d.convertStyleToPx(t)},tr:function(t){t.attributes={}},td:function(t){var e=t.getAscendant("table");(o=(e=p.parseCssText(e.attributes.style,!0)).background)&&d.setStyle(t,"background",o,!0),(e=e["background-color"])&&d.setStyle(t,"background-color",e,!0);var r,n,o=(e=p.parseCssText(t.attributes.style,!0)).border?CKEDITOR.tools.style.border.fromCssRule(e.border):{},o=p.style.border.splitCssValues(e,o),s=CKEDITOR.tools.clone(e);for(r in s)0==r.indexOf("border")&&delete s[r];for(n in t.attributes.style=CKEDITOR.tools.writeCssText(s),e.background&&((r=CKEDITOR.tools.style.parse.background(e.background)).color&&(d.setStyle(t,"background-color",r.color,!0),d.setStyle(t,"background",""))),o)r=e[n]?CKEDITOR.tools.style.border.fromCssRule(e[n]):o[n],"none"===r.style?d.setStyle(t,n,"none"):d.setStyle(t,n,r.toString());d.mapCommonStyles(t),d.convertStyleToPx(t),d.createStyleStack(t,a,i,/margin|text\-align|padding|list\-style\-type|width|height|border|white\-space|vertical\-align|background/i)},font:function(t){var e,r;t.attributes.face&&n&&(t.attributes.face=(e=t.attributes.face,t=n,r=e.split(","),CKEDITOR.tools.array.find(t,function(t){for(var e=0;e<r.length;e++)if(-1===t.indexOf(CKEDITOR.tools.trim(r[e])))return!1;return!0})||e))}}}},b.styles={setStyle:function(t,e,r,n){var o=p.parseCssText(t.attributes.style);n&&o[e]||(""===r?delete o[e]:o[e]=r,t.attributes.style=CKEDITOR.tools.writeCssText(o))},convertStyleToPx:function(t){var e=t.attributes.style;e&&(t.attributes.style=e.replace(/\d+(\.\d+)?pt/g,function(t){return CKEDITOR.tools.convertToPx(t)+"px"}))},mapStyles:function(t,e){for(var r in e)t.attributes[r]&&("function"==typeof e[r]?e[r](t.attributes[r]):d.setStyle(t,e[r],t.attributes[r]),delete t.attributes[r])},mapCommonStyles:function(e){return d.mapStyles(e,{vAlign:function(t){d.setStyle(e,"vertical-align",t)},width:function(t){d.setStyle(e,"width",r(t))},height:function(t){d.setStyle(e,"height",r(t))}})},normalizedStyles:function(t,e){function r(){for(var t=[],e=0;e<arguments.length;e++)arguments[e]&&t.push(arguments[e]);return-1!==p.indexOf(n,t.join(":"))}var n="background-color:transparent border-image:none color:windowtext direction:ltr mso- visibility:visible div:border:none".split(" "),o="font-family font font-size color background-color line-height text-decoration".split(" "),s=!0===CKEDITOR.plugins.pastetools.getConfigValue(e,"removeFontStyles"),i=p.parseCssText(t.attributes.style);"cke:li"==t.name&&(i["TEXT-INDENT"]&&i.MARGIN?(t.attributes["cke-indentation"]=b.lists.getElementIndentation(t),i.MARGIN=i.MARGIN.replace(/(([\w\.]+ ){3,3})[\d\.]+(\w+$)/,"$10$3")):delete i["TEXT-INDENT"],delete i["text-indent"]);for(var a=p.object.keys(i),l=0;l<a.length;l++){var u=a[l].toLowerCase(),c=i[a[l]],d=CKEDITOR.tools.indexOf;(s&&-1!==d(o,u.toLowerCase())||r(null,u,c)||r(null,u.replace(/\-.*$/,"-"))||r(null,u)||r(t.name,u,c)||r(t.name,u.replace(/\-.*$/,"-"))||r(t.name,u)||r(c))&&delete i[a[l]]}var f=CKEDITOR.plugins.pastetools.getConfigValue(e,"keepZeroMargins");return g(i),CKEDITOR.tools.array.forEach(["top","right","bottom","left"],function(t){var e;(t="margin-"+t)in i&&((e=CKEDITOR.tools.convertToPx(i[t]))||f?i[t]=e?e+"px":0:delete i[t])}),CKEDITOR.tools.writeCssText(i)},createStyleStack:function(t,e,r,n){var o=[];for(t.filterChildren(e),e=t.children.length-1;0<=e;e--)o.unshift(t.children[e]),t.children[e].remove();d.sortStyles(t),e=p.parseCssText(d.normalizedStyles(t,r));var s,i,a="span"===(r=t).name;for(s in e)s.match(n||/margin((?!-)|-left|-top|-bottom|-right)|text-indent|text-align|width|border|padding/i)||(a?a=!1:((i=new CKEDITOR.htmlParser.element("span")).attributes.style=s+":"+e[s],r.add(i),r=i,delete e[s]));for(CKEDITOR.tools.isEmpty(e)?delete t.attributes.style:t.attributes.style=CKEDITOR.tools.writeCssText(e),e=0;e<o.length;e++)r.add(o[e])},sortStyles:function(t){for(var r=["border","border-bottom","font-size","background"],e=p.parseCssText(t.attributes.style),n=p.object.keys(e),o=[],s=[],i=0;i<n.length;i++)(-1!==p.indexOf(r,n[i].toLowerCase())?o:s).push(n[i]);for(o.sort(function(t,e){return p.indexOf(r,t.toLowerCase())-p.indexOf(r,e.toLowerCase())}),n=[].concat(o,s),o={},i=0;i<n.length;i++)o[n[i]]=e[n[i]];t.attributes.style=CKEDITOR.tools.writeCssText(o)},pushStylesLower:function(t,e,r){if(!t.attributes.style||0===t.children.length)return!1;e=e||{};var n,o={"list-style-type":!0,width:!0,height:!0,border:!0,"border-":!0},s=p.parseCssText(t.attributes.style);for(n in s)if(!(n.toLowerCase()in o||o[n.toLowerCase().replace(/\-.*$/,"-")]||n.toLowerCase()in e)){for(var i=!1,a=0;a<t.children.length;a++){var l,u=t.children[a];u.type===CKEDITOR.NODE_TEXT&&r&&((l=new CKEDITOR.htmlParser.element("span")).setHtml(u.value),u.replaceWith(l),u=l),u.type===CKEDITOR.NODE_ELEMENT&&(i=!0,d.setStyle(u,n,s[n]))}i&&delete s[n]}return t.attributes.style=CKEDITOR.tools.writeCssText(s),!0},inliner:{filtered:"break-before break-after break-inside page-break page-break-before page-break-after page-break-inside".split(" "),parse:function(t){var e,r,n,o,s,i,a,l=CKEDITOR.tools.parseCssText,u=d.inliner.filter,c=t.is?t.$.sheet:(e=t,r=new CKEDITOR.dom.element("style"),(n=new CKEDITOR.dom.element("iframe")).hide(),CKEDITOR.document.getBody().append(n),n.$.contentDocument.documentElement.appendChild(r.$),r.$.textContent=e,n.remove(),r.$.sheet);if(t=[],c)for(c=c.cssRules,o=0;o<c.length;o++)c[o].type===window.CSSRule.STYLE_RULE&&t.push({selector:c[o].selectorText,styles:u((s=c[o].cssText,a=i=void 0,i=s.indexOf("{"),a=s.indexOf("}"),l(s.substring(i+1,a),!0)))});return t},filter:function(t){var e,r=d.inliner.filtered,n=p.array.indexOf,o={};for(e in t)-1===n(r,e)&&(o[e]=t[e]);return o},sort:function(t){return t.sort((n=CKEDITOR.tools.array.map(t,function(t){return t.selector}),function(t,e){var r=-1!==(""+t.selector).indexOf(".")?1:0;return 0!=(r=(-1!==(""+e.selector).indexOf(".")?1:0)-r)?r:n.indexOf(e.selector)-n.indexOf(t.selector)}));var n},inline:function(t){var e,n=d.inliner.parse,r=d.inliner.sort,s=(e=t,e=(new DOMParser).parseFromString(e,"text/html"),new CKEDITOR.dom.document(e)),r=r(function(t){for(var e=[],r=0;r<t.count();r++)e=e.concat(n(t.getItem(r)));return e}(t=s.find("style")));return CKEDITOR.tools.array.forEach(r,function(t){var e,r,n,o=t.styles;for(t=s.find(t.selector),g(o),n=0;n<t.count();n++)e=t.getItem(n),g(r=CKEDITOR.tools.parseCssText(e.getAttribute("style"))),r=CKEDITOR.tools.extend({},r,o),e.setAttribute("style",CKEDITOR.tools.writeCssText(r))}),s}}},d=b.styles,b.lists={getElementIndentation:function(t){var e;return((t=p.parseCssText(t.attributes.style)).margin||t.MARGIN)&&(t.margin=t.margin||t.MARGIN,e={styles:{margin:t.margin}},CKEDITOR.filter.transformationsTools.splitMarginShorthand(e),t["margin-left"]=e.styles["margin-left"]),parseInt(p.convertToPx(t["margin-left"]||"0px"),10)}},b.elements={replaceWithChildren:function(t){for(var e=t.children.length-1;0<=e;e--)t.children[e].insertAfter(t)}},b.createAttributeStack=function(t,e){var r=[];for(t.filterChildren(e),n=t.children.length-1;0<=n;n--)r.unshift(t.children[n]),t.children[n].remove();var n,o,s,i=t,a=!0;for(o in n=t.attributes)a?a=!1:((s=new CKEDITOR.htmlParser.element(t.name)).attributes[o]=n[o],i.add(s),i=s,delete n[o]);for(n=0;n<r.length;n++)i.add(r[n])},b.parseShorthandMargins=g,b.rtf={getGroups:function(t,e){for(var r,n=[],o=0;r=b.rtf.getGroup(t,e,{start:o});)o=r.end,n.push(r);return n},removeGroups:function(t,e){for(var r;r=b.rtf.getGroup(t,e);)t=t.substring(0,r.start)+(r=t.substring(r.end));return t},getGroup:function(t,e,r){var n=0;if(e=new RegExp("\\{\\\\"+e,"g"),r=CKEDITOR.tools.object.merge({start:0},r||{}),e.lastIndex=r.start,!(r=e.exec(t)))return null;s=t[e=r.index];do{var o="{"===s&&"\\"!==i(t,e,-1)&&"\\"===i(t,e,1),s="}"===s&&"\\"!==i(t,e,-1)&&0<n}while(o?n++:s&&n--,(s=t[++e])&&0<n);return{start:r.index,end:e,content:t.substring(r.index,e)}},extractGroupContent:function(t){var e=(e=t.match(/^\{\\(\w+)/))?e[1]:null;return t=t.replace(/\}([^{\s]+)/g,"} $1"),t=b.rtf.removeGroups(t,"(?!"+e+")"),(t=CKEDITOR.tools.trim(t.replace(/^\{(\\[\w-]+\s*)+/g,""))).replace(/}$/,"")}}}();