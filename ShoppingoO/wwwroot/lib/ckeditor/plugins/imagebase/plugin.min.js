!function(){function d(t){var e=t.widgets,a=t.focusManager.currentActive;if(t.focusManager.hasFocus)return e.focused||(a instanceof CKEDITOR.plugins.widget.nestedEditable?e.getByElement(a):void 0)}function p(t,e){return t.features&&-1!==CKEDITOR.tools.array.indexOf(t.features,e)}function t(t){this.wrapper=CKEDITOR.dom.element.createFromHtml(t||'<div class="cke_loader"></div>')}function e(){t.call(this,'<div class="cke_loader"><div class="cke_bar" styles="transition: width '+i/1e3+'s"></div></div>'),this.bar=this.wrapper.getFirst()}var l,a=!1,n={caption:{setUp:function(i){function t(t){var a,n,e=(t="blur"===t.name?i.elementPath():t.data.path)?t.lastElement:null;if(a=i.widgets.instances,n="caption",t=CKEDITOR.tools.array.reduce(CKEDITOR.tools.object.keys(a),function(t,e){e=a[e];return p(e,n)&&t.push(e),t},[]),!i.filter.check("figcaption"))return CKEDITOR.tools.array.forEach(o,function(t){t.removeListener()});CKEDITOR.tools.array.forEach(t,function(t){t._refreshCaption(e)})}var o=[];o.push(i.on("selectionChange",t,null,null,9)),o.push(i.on("blur",t))},init:function(){var t,e,a;this.editor.filter.check("figcaption")&&(this.parts.caption||(t=this.parts,a=(e=this.element).getDocument().createElement("figcaption"),e.append(a),this.initEditable("caption",this.definition.editables.caption),t.caption=a),this.editables.caption.getData()||this.parts.caption.data("cke-caption-placeholder")||this._refreshCaption())},_refreshCaption:function(t){var e=d(this.editor)===this,a=this.parts.caption,n=this.editables.caption;e?(n.getData()||t.equals(a)?(!t||t.equals(a)&&t.data("cke-caption-placeholder"))&&s(this):this.parts.caption.data("cke-caption-placeholder",this.editor.lang.imagebase.captionPlaceholder),r(a,!0)):this.editables.caption.getData()&&!this.parts.caption.data("cke-caption-placeholder")||(s(this),r(a,!1))}},upload:l={progressReporterType:e,setUp:function(s,r){s.on("paste",function(t){var e=t.data.method,a=t.data.dataTransfer,n=a&&a.getFilesCount();if(!s.readOnly&&("drop"===e||"paste"===e&&n)){var i=[];r=s.widgets.registered[r.name];for(var o=0;o<n;o++)e=a.getFile(o),CKEDITOR.fileTools.isTypeSupported(e,r.supportedTypes)&&i.push(e);i.length&&(t.cancel(),t.stop(),CKEDITOR.tools.array.forEach(i,function(t,e){var a=l._spawnLoader(s,t,r,t.name);l._insertWidget(s,r,URL.createObjectURL(t),!0,{uploadId:a.id}),e!==i.length-1&&((a=s.getSelection().getRanges())[0].enlarge(CKEDITOR.ENLARGE_ELEMENT),a[0].collapse(!1))}))}})},init:function(){this.once("ready",function(){var t=this.data.uploadId;void 0!==t&&(t=this.editor.uploadRepository.loaders[t])&&this._beginUpload(this,t)})},_isLoaderDone:function(t){return t.xhr&&4===t.xhr.readyState},_spawnLoader:function(t,e,a,n){var i=a.loadMethod||"loadAndUpload";return(t=t.uploadRepository.create(e,n,a.loaderType))[i](a.uploadUrl,a.additionalRequestParameters),t},_beginUpload:function(t,e){function a(){t.isInited()&&t.setData("uploadId",void 0),t.wrapper.removeClass("cke_widget_wrapper_uploading")}function n(){a(),!1!==t.fire("uploadFailed",{loader:e})&&t.editor.widgets.del(t)}var i={uploaded:function(){a(),t.fire("uploadDone",{loader:e})},abort:n,error:n},o=[];o.push(e.on("abort",i.abort)),o.push(e.on("error",i.error)),o.push(e.on("uploaded",i.uploaded)),this.on("destroy",function(){CKEDITOR.tools.array.filter(o,function(t){return t.removeListener(),!1})}),t.setData("uploadId",e.id),!1!==t.fire("uploadStarted",e)&&t.progressReporterType&&(t._isLoaderDone(e)?i[e.status]&&i[e.status]():(t.wrapper.addClass("cke_widget_wrapper_uploading"),i=new t.progressReporterType,t.wrapper.append(i.wrapper),i.bindLoader(e)))},_insertWidget:function(t,e,a,n,i){var o=("function"==typeof e.defaults?e.defaults():e.defaults)||{};(o=CKEDITOR.tools.extend({},o)).src=a,a=CKEDITOR.dom.element.createFromHtml(e.template.output(o));var o=t.widgets.wrapElement(a,e.name),s=new CKEDITOR.dom.documentFragment(o.getDocument());return s.append(o),!1!==n?(t.widgets.initOn(a,e,i),t.widgets.finalizeCreation(s)):a}},link:{allowedContent:{a:{attributes:"!href"}},parts:{link:"a"},init:function(){this.editor.plugins.link&&this.editor.contextMenu&&this.on("contextMenu",function(t){this.parts.link&&(t.data.link=t.data.unlink=CKEDITOR.TRISTATE_OFF)})},setUp:function(l){var t;l.plugins.link&&(l.contextMenu&&((t=l).addMenuGroup("imagebase",10),t.addMenuItem("imagebase",{label:t.lang.link.menu,command:"link",group:"imagebase"})),l.on("dialogShow",function(t){var e,a,n,i,o,s=d(l),r=t.data;s&&p(s,"link")&&"link"===r._.name&&(e=r.getContentElement("info","linkDisplayText").getElement().getParent().getParent(),r.setupContent(s.data.link||{}),e.hide(),a=r.once("ok",(n=t,i=r,o=s,function(){var t;o&&p(o,"link")&&(n.stop(),i.commitContent(t={}),o.setData("link",t))}),null,null,9),r.once("hide",function(){a.removeListener(),e.show()}))}),o(l,"exec",function(t,e,a){e.setData("link",null),t.refresh(a,a.elementPath())}),o(l,"refresh",function(t,e){t.setState(e.parts.link?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}))},data:function(t){var e,a=this.editor,n=t.data.link,i=this.element.findOne("img");void 0===n&&this.parts.link&&this.setData("link",CKEDITOR.plugins.link.parseLinkAttributes(this.editor,this.parts.link)),void 0!==n&&(null===n?(this.parts.link.remove(!0),this.parts.link=null,delete t.data.link):(t=this.parts,e=i.getAscendant("a")||a.document.createElement("a"),a=CKEDITOR.plugins.link.getLinkAttributes(a,n),CKEDITOR.tools.isEmpty(a.set)||e.setAttributes(a.set),a.removed.length&&e.removeAttributes(a.removed),e.contains(i)||(e.replace(i),i.move(e)),t.link=e))}}},i=100;function o(a,t,n){a.getCommand("unlink").on(t,function(t){var e=d(a);e&&p(e,"link")&&(t.stop(),n&&"function"==typeof n&&n(this,e,a),t.cancel())})}function s(t){t.parts.caption.data("cke-caption-placeholder",!1)}function r(t,e){t.data("cke-caption-active",e),t.data("cke-caption-hidden",!e)}t.prototype={updated:function(){},done:function(){this.remove()},aborted:function(){this.remove()},failed:function(){this.remove()},remove:function(){this.wrapper.remove()},bindLoader:function(t){function e(){a&&(CKEDITOR.tools.array.forEach(a,function(t){t.removeListener()}),a=null)}var a=[],n=CKEDITOR.tools.eventsBuffer(i,function(){t.uploadTotal&&this.updated(t.uploaded/t.uploadTotal)},this);a.push(t.on("update",n.input,this)),a.push(t.once("abort",this.aborted,this)),a.push(t.once("uploaded",this.done,this)),a.push(t.once("error",this.failed,this)),a.push(t.once("abort",e)),a.push(t.once("uploaded",e)),a.push(t.once("error",e))}},(e.prototype=new t).updated=function(t){t=Math.round(100*t),t=Math.max(t,0),t=Math.min(t,100),this.bar.setStyle("width",t+"%")},CKEDITOR.plugins.add("imagebase",{requires:"widget,filetools",lang:"az,bg,cs,da,de,de-ch,en,en-au,et,fa,fr,gl,hr,hu,it,ku,lt,lv,nb,nl,pl,pt,pt-br,ro,ru,sk,sq,sr,sr-latn,sv,tr,ug,uk,zh,zh-cn",init:function(t){a||(CKEDITOR.document.appendStyleSheet(this.path+"styles/imagebase.css"),a=!0),t.addContentsCss&&t.addContentsCss(this.path+"styles/imagebase.css")}}),CKEDITOR.plugins.imagebase={featuresDefinitions:n,addImageWidget:function(t,e,a){e=t.widgets.add(e,(a=a,(a=CKEDITOR.tools.object.merge({pathName:t.lang.imagebase.pathName,defaults:{imageClass:t.config.easyimage_class||"",alt:"",src:"",caption:""},template:'<figure class="{imageClass}"><img alt="{alt}" src="{src}" /><figcaption>{caption}</figcaption></figure>',allowedContent:{img:{attributes:"!src,alt,width,height"},figure:!0,figcaption:!0},requiredContent:"figure; img[!src]",features:[],editables:{caption:{selector:"figcaption",pathName:t.lang.imagebase.pathNameCaption,allowedContent:"br em strong sub sup u s; a[!href,target]"}},parts:{image:"img",caption:"figcaption"},upcasts:{figure:function(t){if(1===t.find("img",!0).length)return t}}},a)).upcast=CKEDITOR.tools.object.keys(a.upcasts).join(","),a)),t.addFeature(e)},addFeature:function(t,e,a){function n(t,e){if(t||e)return function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)}}var i=CKEDITOR.tools.clone(this.featuresDefinitions[e]);return i.init=n(a.init,i.init),i.data=n(a.data,i.data),i.setUp&&(i.setUp(t,a),delete i.setUp),t=CKEDITOR.tools.object.merge(a,i),CKEDITOR.tools.isArray(t.features)||(t.features=[]),t.features.push(e),t},progressBar:e,progressReporter:t}}();