!function(){function n(s){function i(){this.deflated||(s.widgets.focused==this.widget&&(this.focused=!0),s.widgets.destroy(this.widget),this.deflated=!0)}function n(){var e=s.editable(),t=s.document;if(this.deflated)this.widget=s.widgets.initOn(this.element,"image",this.widget.data),this.widget.inline&&!new CKEDITOR.dom.elementPath(this.widget.wrapper,e).block&&((e=t.createElement(s.activeEnterMode==CKEDITOR.ENTER_P?"p":"div")).replace(this.widget.wrapper),this.widget.wrapper.move(e)),this.focused&&(this.widget.focus(),delete this.focused),delete this.deflated;else{var a=this.widget,e=g,t=a.wrapper,i=a.data.align,a=a.data.hasCaption;if(e){for(var n=3;n--;)t.removeClass(e[n]);"center"==i?a&&t.addClass(e[1]):"none"!=i&&t.addClass(e[p[i]])}else"center"==i?(a?t.setStyle("text-align","center"):t.removeStyle("text-align"),t.removeStyle("float")):("none"==i?t.removeStyle("float"):t.setStyle("float",i),t.removeStyle("text-align"))}}var r,l,o,a,e,t,g=s.config.image2_alignClasses,c=s.config.image2_captionedClass;return{allowedContent:(t=(e=s).config.image2_alignClasses,e={div:{match:d(e)},p:{match:d(e)},img:{attributes:"!src,alt,width,height"},figure:{classes:"!"+e.config.image2_captionedClass},figcaption:!0},t?(e.div.classes=t[1],e.p.classes=e.div.classes,e.img.classes=t[0]+","+t[2],e.figure.classes+=","+e.img.classes):(e.div.styles="text-align",e.p.styles="text-align",e.img.styles="float",e.figure.styles="float,display"),e),requiredContent:"img[src,alt]",features:{dimension:{requiredContent:"img[width,height]"},align:{requiredContent:"img"+((e=(e=s).config.image2_alignClasses)?"("+e[0]+")":"{float}")},caption:{requiredContent:"figcaption"}},styleableElements:"img figure",contentTransformations:[["img[width]: sizeToAttribute"]],editables:{caption:{selector:"figcaption",allowedContent:"br em strong sub sup u s; a[!href,target]"}},parts:{image:"img",caption:"figcaption"},dialog:"image2",template:'<img alt="" src="" />',data:function(){var e=this.features;if(this.data.hasCaption&&!s.filter.checkFeature(e.caption)&&(this.data.hasCaption=!1),"none"==this.data.align||s.filter.checkFeature(e.align)||(this.data.align="none"),this.shiftState({widget:this,element:this.element,oldData:this.oldData,newData:this.data,deflate:i,inflate:n}),this.data.link?this.parts.link||(this.parts.link=this.parts.image.getParent()):this.parts.link&&delete this.parts.link,this.parts.image.setAttributes({src:this.data.src,"data-cke-saved-src":this.data.src,alt:this.data.alt}),this.oldData&&!this.oldData.hasCaption&&this.data.hasCaption)for(var t in this.data.classes)this.parts.image.removeClass(t);if(s.filter.checkFeature(e.dimension))for(var a in e={width:(e=this.data).width,height:e.height},t=this.parts.image,e)e[a]?t.setAttribute(a,e[a]):t.removeAttribute(a);this.oldData=CKEDITOR.tools.extend({},this.data)},init:function(){var e=CKEDITOR.plugins.image2,t=this.parts.image,a={hasCaption:!!this.parts.caption,src:t.getAttribute("src"),alt:t.getAttribute("alt")||"",width:t.getAttribute("width")||"",height:t.getAttribute("height")||"",lock:!this.ready||e.checkHasNaturalRatio(t)},i=t.getAscendant("a");i&&this.wrapper.contains(i)&&(this.parts.link=i),a.align||(t=a.hasCaption?this.element:t,g?(t.hasClass(g[0])?a.align="left":t.hasClass(g[2])&&(a.align="right"),a.align?t.removeClass(g[p[a.align]]):a.align="none"):(a.align=t.getStyle("float")||"none",t.removeStyle("float"))),s.plugins.link&&this.parts.link&&(a.link=e.getLinkAttributesParser()(s,this.parts.link),(t=a.link.advanced)&&t.advCSSClasses&&(t.advCSSClasses=CKEDITOR.tools.trim(t.advCSSClasses.replace(/cke_\S+/,"")))),this.wrapper[(a.hasCaption?"remove":"add")+"Class"]("cke_image_nocaption"),this.setData(a),s.filter.checkFeature(this.features.dimension)&&!0!==s.config.image2_disableResizer&&function(T){var E=T.editor,b=E.editable(),D=E.document,I=T.resizer=D.createElement("span");{var e,t,a;I.addClass("cke_image_resizer"),I.setAttribute("title",E.lang.image2.resizer),I.append(new CKEDITOR.dom.text("â€‹",D)),T.inline?T.wrapper.append(I):(e=T.parts.link||T.parts.image,t=e.getParent(),(a=D.createElement("span")).addClass("cke_image_resizer_wrapper"),a.append(e),a.append(I),T.element.append(a,!0),t.is("span")&&t.remove())}I.on("mousedown",function(e){function t(e,t,a){var i=CKEDITOR.document,n=[];if(D.equals(i)||n.push(i.on(e,t)),n.push(D.on(e,t)),a)for(e=n.length;e--;)a.push(n.pop())}function a(){n=C+u*l,s=Math.round(n/v)}function i(){s=k-o,n=Math.round(s*v)}var n,s,r,l,o,g,c,d,h=T.parts.image,m=(d=E.config.image2_maxSize)?(d=CKEDITOR.tools.copy(d),c=CKEDITOR.plugins.image2.getNatural(h),d.width=Math.max(("natural"===d.width?c:d).width,15),d.height=Math.max(("natural"===d.height?c:d).height,15),d):null,u="right"==T.data.align?-1:1,p=e.data.$.screenX,f=e.data.$.screenY,C=h.$.clientWidth,k=h.$.clientHeight,v=C/k,w=[],_="cke_image_s"+(~u?"e":"w");E.fire("saveSnapshot"),t("mousemove",function(e){g=e.data.$,l=g.screenX-p,o=f-g.screenY,g=Math.abs(l/o),(1==u?l<=0?o<=0||v<=g?a:i:!(o<=0)||v<=g?i:a:l<=0?!(o<=0)||v<=g?i:a:o<=0||v<=g?a:i)(),e=m&&(n>m.width||s>m.height),n<15||s<15||e||(r={width:n,height:s},h.setAttributes(r))},w),t("mouseup",function(){for(var e;e=w.pop();)e.removeListener();b.removeClass(_),I.removeClass("cke_image_resizing"),r&&(T.setData(r),E.fire("saveSnapshot")),r=!1},w),b.addClass(_),I.addClass("cke_image_resizing")}),T.on("data",function(){I["right"==T.data.align?"addClass":"removeClass"]("cke_image_resizer_left")})}(this),this.shiftState=e.stateShifter(this.editor),this.on("contextMenu",function(e){e.data.image=CKEDITOR.TRISTATE_OFF,(this.parts.link||this.wrapper.getAscendant("a"))&&(e.data.link=e.data.unlink=CKEDITOR.TRISTATE_OFF)})},addClass:function(e){m(this).addClass(e)},hasClass:function(e){return m(this).hasClass(e)},removeClass:function(e){m(this).removeClass(e)},getClasses:(a=new RegExp("^("+[].concat(c,g).join("|")+")$"),function(){var e,t=this.repository.parseElementClasses(m(this).getAttribute("class"));for(e in t)a.test(e)&&delete t[e];return t}),upcast:(l=d(s),o=s.config.image2_captionedClass,function(e,t){var a,i={width:1,height:1},n=e.name;if(!e.attributes["data-cke-realelement"]&&(l(e)?("div"==n&&(a=e.getFirst("figure"))&&(e.replaceWith(a),e=a),t.align="center",a=e.getFirst("img")||e.getFirst("a").getFirst("img")):"figure"==n&&e.hasClass(o)?a=e.find(function(e){return"img"===e.name&&-1!==CKEDITOR.tools.array.indexOf(["figure","a"],e.parent.name)},!0)[0]:h(e)&&(a="a"==e.name?e.children[0]:e),a)){for(var s in i)(i=a.attributes[s])&&i.match(f)&&delete a.attributes[s];return e}}),downcast:(r=s.config.image2_alignClasses,function(e){var t,a="a"==e.name?e.getFirst():e,i=a.attributes,n=this.data.align;return this.inline||(t=e.getFirst("span"))&&t.replaceWith(t.getFirst({img:1,a:1})),n&&"none"!=n&&(t=CKEDITOR.tools.parseCssText(i.style||""),"center"==n&&"figure"==e.name?e=e.wrapWith(new CKEDITOR.htmlParser.element("div",r?{class:r[1]}:{style:"text-align:center"})):n in{left:1,right:1}&&(r?a.addClass(r[p[n]]):t.float=n),r||CKEDITOR.tools.isEmpty(t)||(i.style=CKEDITOR.tools.writeCssText(t))),e}),getLabel:function(){return this.editor.lang.widget.label.replace(/%1/,(this.data.alt||"")+" "+this.pathName)}}}function d(a){var i=a.config.image2_captionedClass,n=a.config.image2_alignClasses,s={figure:1,a:1,img:1};return function(e){if(!(e.name in{div:1,p:1}))return!1;var t=e.children;if(1!==t.length)return!1;if(!((t=t[0]).name in s))return!1;if("p"==e.name){if(!h(t))return!1}else if("figure"==t.name){if(!t.hasClass(i))return!1}else if(a.enterMode==CKEDITOR.ENTER_P||!h(t))return!1;return!(n?!e.hasClass(n[1]):"center"!=CKEDITOR.tools.parseCssText(e.attributes.style||"",!0)["text-align"])}}function h(e){return"img"==e.name||"a"==e.name&&(1==e.children.length&&e.getFirst("img"))}function o(e){return(e=e.widgets.focused)&&"image"==e.name?e:null}function m(e){return e.data.hasCaption?e.element:e.parts.image}var u=new CKEDITOR.template('<figure class="{captionedClass}"><img alt="" src="" /><figcaption>{captionPlaceholder}</figcaption></figure>'),p={left:0,center:1,right:2},f=/^\s*(\d+\%)\s*$/i;CKEDITOR.plugins.add("image2",{lang:"af,ar,az,bg,bn,bs,ca,cs,cy,da,de,de-ch,el,en,en-au,en-ca,en-gb,eo,es,es-mx,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,oc,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",requires:"widget,dialog",icons:"image",hidpi:!0,onLoad:function(){CKEDITOR.addCss('.cke_image_nocaption{line-height:0}.cke_editable.cke_image_sw, .cke_editable.cke_image_sw *{cursor:sw-resize !important}.cke_editable.cke_image_se, .cke_editable.cke_image_se *{cursor:se-resize !important}.cke_image_resizer{display:none;position:absolute;width:10px;height:10px;bottom:-5px;right:-5px;background:#000;outline:1px solid #fff;line-height:0;cursor:se-resize;}.cke_image_resizer_wrapper{position:relative;display:inline-block;line-height:0;}.cke_image_resizer.cke_image_resizer_left{right:auto;left:-5px;cursor:sw-resize;}.cke_widget_wrapper:hover .cke_image_resizer,.cke_image_resizer.cke_image_resizing{display:block}.cke_editable[contenteditable="false"] .cke_image_resizer{display:none;}.cke_widget_wrapper>a{display:inline-block}')},init:function(e){var t,a,i;e.plugins.detectConflict("image2",["easyimage"])||(t=e.config,a=e.lang.image2,i=n(e),t.filebrowserImage2BrowseUrl=t.filebrowserImageBrowseUrl,t.filebrowserImage2UploadUrl=t.filebrowserImageUploadUrl,i.pathName=a.pathName,i.editables.caption.pathName=a.pathNameCaption,e.widgets.add("image",i),e.ui.addButton&&e.ui.addButton("Image",{label:e.lang.common.image,command:"image",toolbar:"insert,10"}),e.contextMenu&&(e.addMenuGroup("image",10),e.addMenuItem("image",{label:a.menu,command:"image",group:"image"})),CKEDITOR.dialog.add("image2",this.path+"dialogs/image2.js"))},afterInit:function(e){var t,i,n,s,r,a,l=(i=e,s=[],function(a){var e=i.getCommand("justify"+a);e&&(s.push(function(){e.refresh(i,i.elementPath())}),a in{right:1,left:1,center:1}&&e.on("exec",function(e){var t=o(i);if(t){for(t.setData("align",a),t=s.length;t--;)s[t]();e.cancel()}}),e.on("refresh",function(e){var t=o(i);t&&((n=void 0===n?i.filter.checkFeature(i.widgets.registered.image.features.align):n)?this.setState(t.data.align==a?CKEDITOR.TRISTATE_ON:a in{right:1,left:1,center:1}?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED):this.setState(CKEDITOR.TRISTATE_DISABLED),e.cancel())}))});for(t in{left:1,right:1,center:1,block:1})l(t);(r=e).plugins.link&&(a=CKEDITOR.on("dialogDefinition",function(e){var a,i;"link"==(e=e.data).name&&(a=(e=e.definition).onShow,i=e.onOk,e.onShow=function(){var e=o(r),t=this.getContentElement("info","linkDisplayText").getElement().getParent().getParent();!e||e.inline&&e.wrapper.getAscendant("a")?(t.show(),a.apply(this,arguments)):(this.setupContent(e.data.link||{}),t.hide())},e.onOk=function(){var e,t=o(r);!t||t.inline&&t.wrapper.getAscendant("a")?i.apply(this,arguments):(this.commitContent(e={}),t.setData("link",e))})}),r.on("destroy",function(){a.removeListener()}),r.getCommand("unlink").on("exec",function(e){var t=o(r);t&&t.parts.link&&(t.setData("link",null),this.refresh(r,r.elementPath()),e.cancel())}),r.getCommand("unlink").on("refresh",function(e){var t=o(r);t&&(this.setState(t.data.link||t.wrapper.getAscendant("a")?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),e.cancel())}))}}),CKEDITOR.plugins.image2={stateShifter:function(l){function n(e,t){var a={};return s?a.attributes={class:s[1]}:a.styles={"text-align":"center"},i(a=o.createElement(e.activeEnterMode==CKEDITOR.ENTER_P?"p":"div",a),t),t.move(a),a}function i(e,t){var a;t.getParent()?((a=l.createRange()).moveToPosition(t,CKEDITOR.POSITION_BEFORE_START),t.remove(),g.insertElementIntoRange(e,a)):e.replace(t)}var o=l.document,s=l.config.image2_alignClasses,r=l.config.image2_captionedClass,g=l.editable(),c=["hasCaption","align","link"],d={align:function(e,t,a){var i=e.element;e.changed.align?e.newData.hasCaption||("center"==a&&(e.deflate(),e.element=n(l,i)),e.changed.hasCaption||"center"!=t||"center"==a||(e.deflate(),(t=i.findOne("a,img")).replace(i),e.element=t)):"center"==a&&e.changed.hasCaption&&!e.newData.hasCaption&&(e.deflate(),e.element=n(l,i)),!s&&i.is("figure")&&("center"==a?i.setStyle("display","inline-block"):i.removeStyle("display"))},hasCaption:function(e,t,a){e.changed.hasCaption&&(t=e.element.is({img:1,a:1})?e.element:e.element.findOne("a,img"),e.deflate(),a?(i(a=CKEDITOR.dom.element.createFromHtml(u.output({captionedClass:r,captionPlaceholder:l.lang.image2.captionPlaceholder}),o),e.element),t.replace(a.findOne("img")),e.element=a):(t.replace(e.element),e.element=t))},link:function(e,t,a){var i,n,s,r;e.changed.link&&(i=e.element.is("img")?e.element:e.element.findOne("img"),n=e.element.is("a")?e.element:e.element.findOne("a"),(s=e.element.is("a")&&!a||e.element.is("img")&&a)&&e.deflate(),a?(t||((r=o.createElement("a",{attributes:{href:e.newData.link.url}})).replace(i),i.move(r)),a=CKEDITOR.plugins.image2.getLinkAttributesGetter()(l,a),CKEDITOR.tools.isEmpty(a.set)||(r||n).setAttributes(a.set),a.removed.length&&(r||n).removeAttributes(a.removed)):((a=n.findOne("img")).replace(n),r=a),s&&(e.element=r))}};return function(e){var t,a;for(e.changed={},a=0;a<c.length;a++)e.changed[t=c[a]]=!!e.oldData&&e.oldData[t]!==e.newData[t];for(a=0;a<c.length;a++)d[t=c[a]](e,e.oldData?e.oldData[t]:null,e.newData[t]);e.inflate()}},checkHasNaturalRatio:function(e){var t=e.$;return e=this.getNatural(e),Math.round(t.clientWidth/e.width*e.height)==t.clientHeight||Math.round(t.clientHeight/e.height*e.width)==t.clientWidth},getNatural:function(e){var t;return e=e.$.naturalWidth?{width:e.$.naturalWidth,height:e.$.naturalHeight}:((t=new Image).src=e.getAttribute("src"),{width:t.width,height:t.height})},getLinkAttributesGetter:function(){return CKEDITOR.plugins.link.getLinkAttributes},getLinkAttributesParser:function(){return CKEDITOR.plugins.link.parseLinkAttributes}}}(),CKEDITOR.config.image2_captionedClass="image";