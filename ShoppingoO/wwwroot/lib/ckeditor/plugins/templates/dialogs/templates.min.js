CKEDITOR.dialog.add("templates",function(a){function c(e){var t=CKEDITOR.dialog.getCurrent();t.getValueOf("selectTpl","chkInsertOpt")?(a.fire("saveSnapshot"),a.setData(e,function(){t.hide();var e=a.createRange();e.moveToElementEditStart(a.editable()),e.select(),setTimeout(function(){a.fire("saveSnapshot")},0)})):(a.insertHtml(e),t.hide())}function e(e){var t=e.data.getTarget(),a=d.equals(t);if(a||d.contains(t)){var l,s=e.data.getKeystroke(),i=d.getElementsByTag("a");if(i){if(a)l=i.getItem(0);else switch(s){case 40:l=t.getNext();break;case 38:l=t.getPrevious();break;case 13:case 32:t.fire("click")}l&&(l.focus(),e.data.preventDefault())}}}var t=CKEDITOR.plugins.get("templates");CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(t.path+"dialogs/templates.css"));var d,t="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),m=a.lang.templates,g=a.config;return{title:a.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:m.title,elements:[{type:"vbox",padding:5,children:[{id:"chkInsertOpt",type:"checkbox",label:m.insertOption,default:g.templates_replaceContent},{id:"selectTplText",type:"html",html:"<span>"+m.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:!0,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+t+'"><div class="cke_tpl_loading"><span></span></div></div><span class="cke_voice_label" id="'+t+'">'+m.options+"</span>"}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var r=this.getContentElement("selectTpl","templatesList");d=r.getElement(),CKEDITOR.loadTemplates(g.templates_files,function(){var e=(g.templates||"default").split(",");if(e.length){var t=d;t.setHtml("");for(var a=0,l=e.length;a<l;a++)for(var s=CKEDITOR.getTemplates(e[a]),i=s.imagesPath,n=(s=s.templates).length,o=0;o<n;o++){var p=function(e,t){var a=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>'),l='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';return e.image&&t&&(l+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(t+e.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>'),l+='<td style="white-space:normal;"><span class="cke_tpl_title">'+e.title+"</span><br/>",e.description&&(l+="<span>"+e.description+"</span>"),l+="</td></tr></table>",a.getFirst().setHtml(l),a.on("click",function(){var t;e.htmlFile?((t=CKEDITOR.dialog.getCurrent()).setState(CKEDITOR.DIALOG_STATE_BUSY),CKEDITOR.ajax.loadText(e.htmlFile,function(e){c(e),t.setState(CKEDITOR.DIALOG_STATE_IDLE)})):c(e.html)}),a}(s[o],i);p.setAttribute("aria-posinset",o+1),p.setAttribute("aria-setsize",n),t.append(p)}r.focus()}else d.setHtml('<div class="cke_tpl_empty"><span>'+m.emptyListMsg+"</span></div>")}),this._.element.on("keydown",e)},onHide:function(){this._.element.removeListener("keydown",e)}}});